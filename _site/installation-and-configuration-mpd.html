<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>安装和配置 MPD | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="使用 i3 窗口管理器，感觉很舒服，更有帅帅的 i3status 点缀之，在 GitHub 搜了下，发现有个 i3status 修改版，可以显示 MPD 的播放状态，于是又用起 MPD。" />
    <meta name="keywords" content="MPD, MPC, 播放器" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://127.0.0.1:4000/installation-and-configuration-mpd" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          安装和配置 MPD
        </h1>
        <h2 class="sub-heading">
            <i class="icon-calendar"></i><time datetime="2012-12-01">2012 年 12 月 01 日</time>
        </h2>
      </header>
  <article class="post-content">
    
  <div class="main-content">
<ul id="toc">
  <li><a href="#id-mpd" id="markdown-toc-id-mpd">MPD</a></li>
  <li><a href="#id-section" id="markdown-toc-id-section">均衡器</a></li>
  <li><a href="#id-mpc" id="markdown-toc-id-mpc">MPC</a></li>
  <li><a href="#id-section-1" id="markdown-toc-id-section-1">多媒体键</a></li>
  <li><a href="#id-section-2" id="markdown-toc-id-section-2">键映射</a></li>
</ul>

<p>使用 i3 窗口管理器，感觉很舒服，更有帅帅的 i3status 点缀之，在 GitHub 搜了下，发现有个 <a href="https://github.com/Gravemind/i3status">i3status 修改版</a>，可以显示 MPD 的播放状态，于是又用起 MPD。</p>

<p>MPD (<a href="https://wiki.archlinux.org/index.php/Music_Player_Daemon">Music Player Daemon</a>) 是一个实用的音乐播放器，以其独特的 C/S 结构获得人们的喜爱。充其量 MPD 只是作为一个守护进程（或者可以说服务）运行于后台，想要控制它的播放，还需要一个客户端，一般只选用 MPC (Music Player Command)， MPC 虽为命令行客户端，但已够用。</p>

<p>下面一起来安装配置 MPD，获得恰到好处的使用体验</p>

<h2 id="id-mpd">MPD</h2>

<p>安装 MPD, MPC</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacman -S mpd mpc
</code></pre>
</div>

<p>创建 MPD 的配置文件</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.mpdconf</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>music_directory         "~/Music/"
playlist_directory      "~/.mpd/playlists"
db_file                 "~/.mpd/database"
log_file                "~/.mpd/log"
pid_file                "~/.mpd/pid"
state_file              "~/.mpd/state"
user                    "fooleap"
group                   "users"
bind_to_address         "localhost"
port                    "6600"
audio_output {
	type            "alsa"
	name            "My ALSA Device"
	mixer_control   "Master"
}</code></pre>

<p>更多配置可参考 /usr/share/mpd/mpd.conf.example</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mkdir -p ~/.mpd/playlists
$ touch ~/.mpd/{database,log,pid,state}
</code></pre>
</div>

<p>至此，可直接运行 mpd 命令以启动</p>

<p>通过 systemd 设置自启，默认配置不是普通用户的，遂先修改 mpd.service 文件，指定配置</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>/usr/lib/systemd/system/mpd.service</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>...
[Service]
ExecStart=/usr/bin/mpd /home/fooleap/.mpdconf --no-daemon
...</code></pre>

<div class="highlighter-rouge"><pre class="highlight"><code># systemctl enable mpd
</code></pre>
</div>

<h2 id="id-section">均衡器</h2>

<p>播放器是有了，但 MPD 不带均衡器，在此使用 <a href="http://www.thedigitalmachine.net/alsaequal.html">Alsaequal</a> 充当均衡器</p>

<p>安装</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ yaourt -S alsaequal caps
</code></pre>
</div>

<p>配置</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.asoundrc</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>ctl.equal {
 type equal;
}

pcm.plugequal {
  type equal;
  # Modify the line below if you do not
  # want to use sound card 0.
  #slave.pcm "plughw:0,0";
  #by default we want to play from more sources at time:
  slave.pcm "plug:dmix";
}
#pcm.equal {
  # If you don't want the equalizer to be your
  # default soundcard comment the following
  # line and uncomment the above line. (You can
  # choose it as the output device by addressing
  # it with specific apps,eg mpg123 -a equal 06.Back_In_Black.mp3)
pcm.!default {
  type plug;
  slave.pcm plugequal;
}</code></pre>

<p>重启 Alsa 后，可调整增益值</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ alsamixer -D equal
</code></pre>
</div>

<p><img src="http://source.fooleap.org/installation-and-configuration-mpd-01.png" alt="Alsaequal" />
配置 MPD</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.mpdconf</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>...
audio_output {
  type    "alsa"
  name    "My ALSA Device"
  device  "plug:plugequal"
  mixer_control	"Master"		# optional
}
...</code></pre>

<h2 id="id-mpc">MPC</h2>

<p>尝试播放</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mpc listall | mpc add
$ mpc play
</code></pre>
</div>

<ul>
<li>添加所有音乐到当前播放列表</li>
<li>播放</li>
</ul>

<p>播放列表</p>

<p>通过 MPC 创建的是 *.m3u 格式的 Playlist</p>

<p>假设 ~/Music 文件夹里有多个文件夹，创建播放列表，包含某目录（或多目录）下所有音乐</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mpc clear
$ mpc ls
$ mpc listall FolderName1 FolderName2 .. | mpc add
$ mpc save playlist
$ mpc load playlist
</code></pre>
</div>

<ul>
<li>清空当前播放列表</li>
<li>列出文件夹</li>
<li>显示名字为 FolderName1 FolderName2 文件夹下的所有音乐并添加到当前播放列表</li>
<li>保存当前播放列表为 playlist</li>
<li>读取播放列表 playlist</li>
</ul>

<p>也可以通过类似下面的命令来创建播放列表，萝卜青菜</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd ~/Music
$ find * -iname "*.mp3" | sort | grep Keyword &gt; ~/.mpd/playlist/playlist.m3u
</code></pre>
</div>

<p>更多使用可以参考 man mpc</p>

<h2 id="id-section-1">多媒体键</h2>

<p>使用 Thinkpad 多媒体键来代替常用的 mpc 命令再合适不过，这里通过 <a href="https://wiki.archlinux.org/index.php/Xbindkeys">Xbindkeys</a> 来绑定</p>

<p>安装 Xbindkeys</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacman -S xbindkeys
</code></pre>
</div>

<p>配置 Xbindkeys</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.xbindkeysrc</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>"mpc toggle"
XF86AudioPlay

"mpc stop"
XF86AudioStop

"mpc prev"
XF86AudioPrev

"mpc next"
XF86AudioNext

"amixer sset Master 2-"
XF86AudioLowerVolume

"amixer sset Master 2+"
XF86AudioRaiseVolume

"amixer sset Master toggle"
XF86AudioMute</code></pre>

<p>将 xbindkeys &amp; 添加到 ~/.xinitrc 使其随 X 启动</p>

<h2 id="id-section-2">键映射</h2>

<p>在此之前，可能需要通过 <a href="https://wiki.archlinux.org/index.php/Xmodmap">Xmodmap</a> 修改键映射</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.Xmodmap</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>!Media
keycode 173 = XF86AudioPrev
keycode 172 = XF86AudioPlay
keycode 171 = XF86AudioNext
keycode 174 = XF86AudioStop

!Volume
keycode 121 = XF86AudioMute
keycode 122 = XF86AudioLowerVolume
keycode 123 = XF86AudioRaiseVolume</code></pre>

<p>将 xmodmap ~/.Xmodmap &amp; 添加到 ~/.xinitrc 使其随 X 启动</p>

<p><img src="http://source.fooleap.org/installation-and-configuration-mpd-02.png" alt="i3status with mpd" /></p>

<p><strong>本文历史</strong></p>

<ul>
  <li>2012 年 12 月 01 日 创建文章</li>
  <li>2012 年 12 月 02 日 修正 mpc 歌曲列表部分的错误</li>
  <li>2012 年 12 月 15 日 添加配置均衡器</li>
  <li>2015 年 05 月 24 日 换图床</li>
</ul>

  </div>

  <div id="posts">
    <div id="random-posts" class="posts">
      <strong>猜你喜欢</strong>
      <ul>
      </ul>
    </div>
  
    <div id="recent-posts" class="posts">
      <strong>最近更新</strong>
      <ul>
      
        <li><a href="/configuring-ip-address-by-specifying-gateway" title="配置特定 IP 地址走指定网关">配置特定 IP 地址走指定网关 </a></li>
      
        <li><a href="/add-google-satellite-layer-in-amap" title="高德地图 API 叠加谷歌地图图层">高德地图 API 叠加谷歌地图图层 </a></li>
      
        <li><a href="/from-codoon-to-nikeplus" title="将咕咚的数据导入到 Nike+">将咕咚的数据导入到 Nike+ </a></li>
      
        <li><a href="/the-influence-of-sports-apps" title="运动 APP 的作用">运动 APP 的作用 </a></li>
      
        <li><a href="/the-last-run-of-june" title="今年 6 月的最后一次跑步">今年 6 月的最后一次跑步 </a></li>
      
      </ul>
    </div>
  </div>

  <div id="info" class="tech">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://127.0.0.1:4000/installation-and-configuration-mpd" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=安装和配置 MPD | 殷东亮的博客 via @&amp;url=http://127.0.0.1:4000/installation-and-configuration-mpd&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://127.0.0.1:4000/installation-and-configuration-mpd&amp;title=安装和配置 MPD | 殷东亮的博客&amp;summary=使用 i3 窗口管理器，感觉很舒服，更有帅帅的 i3status 点缀之，在 GitHub 搜了下，发现有个 i3status 修改版，可以显示 MPD 的播放状态，于是又用起 MPD。&amp;site=http://127.0.0.1:4000"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1:4000/installation-and-configuration-mpd&amp;text=安装和配置 MPD｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://127.0.0.1:4000/installation-and-configuration-mpd&amp;t=安装和配置 MPD | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://127.0.0.1:4000/installation-and-configuration-mpd"><i class="icon-gplus-squared"></i></a>
</span>


    <span class='like'><a href="javascript:void(0)" title=""><i class="icon-heart-empty"></i> <span class="disqus-like-count"></span></a></span>
    <span class='view-code'><a href="javascript:void(0)" data-md="https://raw.githubusercontent.com/fooleap/fooleap.github.io/master/_posts/2012-12-01-installation-and-configuration-mpd.md" title="在正文中查看源码"><i class="icon-file-code"></i>源码</a></span>
    <span class="number-of-word"><i class="icon-calc"></i>3172 字</span>
    <span class="page-tags"><i class="icon-tags"></i><ul class="tags"> <li class="tag"><a href="/tags.html#MPD" target="_blank" title="查看“MPD”的相关文章">MPD</a></li><li class="tag"><a href="/tags.html#MPC" target="_blank" title="查看“MPC”的相关文章">MPC</a></li><li class="tag"><a href="/tags.html#播放器" target="_blank" title="查看“播放器”的相关文章">播放器</a></li></ul></span>
  </div>

</article>

<div class="comment" id="disqus_thread">
    <a class="show-comments" href="http://127.0.0.1:4000/installation-and-configuration-mpd#disqus_thread" data-disqus-identifier="/installation-and-configuration-mpd"><span class="has-comment"><i class="icon-chat-empty"></i> 留下</span>评论 <span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:4000/installation-and-configuration-mpd"></span></a>
</div>

  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  </body>
</html>

<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>利用七牛 API 显示照片的 Exif | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="常访问鄙人博客的朋友，将鼠标覆盖到博客中的某一张图片时，会看到上方会显示该照片的拍摄日期、器材、曝光数据等，看起来好像有点意（zhuāng）思（bī），我就是相片拍得那么烂也好意思晒数据，因为总感觉缺点什么。" />
    <meta name="keywords" content="七牛, Exif, JavaScript" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://127.0.0.1:4000/show-exif-data-of-photo" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          利用七牛 API 显示照片的 Exif
        </h1>
        <h2 class="sub-heading">
            <i class="icon-calendar"></i><time datetime="2015-12-04">2015 年 12 月 04 日</time>
        </h2>
      </header>
  <article class="post-content">
    
  <div class="main-content">
<p>常访问鄙人博客的朋友，将鼠标覆盖到博客中的某一张图片时，会看到上方会显示该照片的拍摄日期、器材、曝光数据等，看起来好像有点意（zhuāng）思（bī），我就是相片拍得那么烂也好意思晒数据，因为总感觉缺点什么。</p>

<p>那些数据都源于该照片的 Exif，Exif 是专门为数码照片所设定的，可以记录数码照片的属性信息及拍摄数据。Exif 可以嵌入在 JPEG 等文件中，用数码相机或者手机拍摄的照片文件，一般附加有 Exif 数据。</p>

<p>如果是本地的照片文件，很多图片浏览器都有查看图片 Exif 数据的功能，例如 <a href="/irfanview.html">IrfanView</a>。如果是在线的图片呢？Chrome 使用 EXIF Viewer 扩展可以在鼠标划过的时候显示 Exif 信息，Firefox 的 Exif Viewer 扩展则是通过右键菜单可查看。不过在线的图片有些是用户后期处理没保留 Exif，有些则被网站处理过，相当多的图片其实已经不包含 Exif 数据，鄙人觉得这些扩展并不是很实用。</p>

<p>有些照片存储分享平台或摄影社区，如 Flickr、图虫等，在展示相片的同时，会在旁边附上处理过的 Exif 数据信息，以方便网友参考，带去启发，拍出好片。</p>

<p>那么，在个人网站或者博客上面，应该如何显示这些信息比较好？</p>

<p>exif-js<a href="https://github.com/exif-js/exif-js" title="exif-js/exif-js·GitHub">[1]</a> 是一个提供读取相片 Exif 数据功能的 JS 库，兼容现代浏览器。GitHub 上有例子，这个就不展开讲，因为还有更加方便的方法。</p>

<p>鄙人多次提及的七牛，其 API 可以很轻松地获取到图片的 Exif 信息<a href="http://developer.qiniu.com/docs/v6/api/reference/fop/image/exif.html" title="EXIF信息（exif） | 七牛云存储">[2]</a>，所以使用七牛做图床，读取到相关的信息很方便。</p>

<p>直接在图片 URL 后加 <code class="highlighter-rouge">exif</code> 指示符即可获取到相关 JSON 字符串，例如：</p>

<p><img src="http://source.fooleap.org/show-exif-data-of-photo.jpg_640" alt="金鸿路上的风景" />
▲金鸿路上的风景</p>

<p>以上相片的 Exif 数据如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>http://source.fooleap.org/show-exif-data-of-photo.jpg?exif
</code></pre>
</div>

<p>鄙人所取的那几个数据，对应格式化后如下：</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nt">"DateTimeOriginal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"val"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012:08:01 07:48:12"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"ExposureTime"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"val"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1/400 sec."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"FNumber"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"val"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f/8.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"FocalLength"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"val"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4.3 mm"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"ISOSpeedRatings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"val"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"Model"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"val"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Canon IXUS 220HS"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>将以上数据取出来显示在网页里，可以用 JavaScript 实现，若 HTML 如下：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://source.fooleap.org/show-exif-data-of-photo.jpg_640"</span> <span class="na">id=</span><span class="s">"photo"</span> <span class="nt">/&gt;</span></code></pre></figure>

<p>那么 JavaScript 可以这么写：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">xhrExif</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhrExif</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'http://source.fooleap.org/show-exif-data-of-photo.jpg?exif'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xhrExif</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">exif</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhrExif</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">xhrExif</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhrExif</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">datetime</span> <span class="o">=</span> <span class="nx">exif</span><span class="p">.</span><span class="nx">DateTimeOriginal</span><span class="p">.</span><span class="nx">val</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/</span><span class="se">\:</span><span class="sr">|</span><span class="se">\s</span><span class="sr">/</span><span class="p">);</span>
  <span class="nx">date</span> <span class="o">=</span> <span class="nx">datetime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'-'</span> <span class="o">+</span> <span class="nx">datetime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'-'</span> <span class="o">+</span> <span class="nx">datetime</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
  <span class="nx">model</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">Model</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">val</span><span class="p">)</span> <span class="p">:</span> <span class="s1">'无'</span><span class="p">;</span>
  <span class="nx">fnum</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">FNumber</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">FNumber</span><span class="p">.</span><span class="nx">val</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/</span><span class="se">\/</span><span class="sr">/</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span> <span class="s1">'无'</span><span class="p">;</span>
  <span class="nx">extime</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">ExposureTime</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">ExposureTime</span><span class="p">.</span><span class="nx">val</span><span class="p">)</span> <span class="p">:</span> <span class="s1">'无'</span><span class="p">;</span>
  <span class="nx">iso</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">ISOSpeedRatings</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">ISOSpeedRatings</span><span class="p">.</span><span class="nx">val</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/,</span><span class="se">\s</span><span class="sr">/</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="s1">'无'</span><span class="p">;</span>
  <span class="nx">flength</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">FocalLength</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">exif</span><span class="p">.</span><span class="nx">FocalLength</span><span class="p">.</span><span class="nx">val</span><span class="p">)</span> <span class="p">:</span> <span class="s1">'无'</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'photo'</span><span class="p">).</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">'afterend'</span><span class="p">,</span> <span class="s1">'&lt;div id="exif"&gt;日期: '</span> <span class="o">+</span> <span class="nx">date</span> <span class="o">+</span> <span class="s1">' 器材: '</span> <span class="o">+</span> <span class="nx">model</span> <span class="o">+</span> <span class="s1">' 光圈: '</span> <span class="o">+</span> <span class="nx">fnum</span> <span class="o">+</span> <span class="s1">' 快门: '</span> <span class="o">+</span> <span class="nx">extime</span> <span class="o">+</span> <span class="s1">' 感光度: '</span> <span class="o">+</span> <span class="nx">iso</span> <span class="o">+</span> <span class="s1">' 焦距: '</span> <span class="o">+</span> <span class="nx">flength</span> <span class="o">+</span> <span class="s1">'&lt;/div&gt;'</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>具体的实例见 http://runjs.cn/detail/b4q6pvet</p>

<iframe style="width: 100%; height: 460px" src="http://sandbox.runjs.cn/show/b4q6pvet" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>所用到的主要知识点可以看看阮一峰的 Ajax 教程<a href="http://javascript.ruanyifeng.com/bom/ajax.html" title="Ajax -- JavaScript 标准参考教程（alpha）">[3]</a>，使用 jQuery 或许会更加方便一点。而具体用到博客上，需要考虑的可能更多，这里就不多说了，有兴趣可以查看源码，欣赏鄙人写的那蹩脚的 JS。</p>

<h2 id="id-section">参考资料</h2>

<p><strong>本文历史</strong></p>

<ul>
  <li>2015 年 12 月 04 日 完成初稿</li>
</ul>

  </div>

  <div id="posts">
    <div id="random-posts" class="posts">
      <strong>猜你喜欢</strong>
      <ul>
      </ul>
    </div>
  
    <div id="recent-posts" class="posts">
      <strong>最近更新</strong>
      <ul>
      
        <li><a href="/configuring-ip-address-by-specifying-gateway" title="配置特定 IP 地址走指定网关">配置特定 IP 地址走指定网关 </a></li>
      
        <li><a href="/add-google-satellite-layer-in-amap" title="高德地图 API 叠加谷歌地图图层">高德地图 API 叠加谷歌地图图层 </a></li>
      
        <li><a href="/from-codoon-to-nikeplus" title="将咕咚的数据导入到 Nike+">将咕咚的数据导入到 Nike+ </a></li>
      
        <li><a href="/the-influence-of-sports-apps" title="运动 APP 的作用">运动 APP 的作用 </a></li>
      
        <li><a href="/the-last-run-of-june" title="今年 6 月的最后一次跑步">今年 6 月的最后一次跑步 </a></li>
      
      </ul>
    </div>
  </div>

  <div id="info" class="tech">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://127.0.0.1:4000/show-exif-data-of-photo" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=利用七牛 API 显示照片的 Exif | 殷东亮的博客 via @&amp;url=http://127.0.0.1:4000/show-exif-data-of-photo&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://127.0.0.1:4000/show-exif-data-of-photo&amp;title=利用七牛 API 显示照片的 Exif | 殷东亮的博客&amp;summary=常访问鄙人博客的朋友，将鼠标覆盖到博客中的某一张图片时，会看到上方会显示该照片的拍摄日期、器材、曝光数据等，看起来好像有点意（zhuāng）思（bī），我就是相片拍得那么烂也好意思晒数据，因为总感觉缺点什么。&amp;site=http://127.0.0.1:4000"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1:4000/show-exif-data-of-photo&amp;text=利用七牛 API 显示照片的 Exif｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://127.0.0.1:4000/show-exif-data-of-photo&amp;t=利用七牛 API 显示照片的 Exif | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://127.0.0.1:4000/show-exif-data-of-photo"><i class="icon-gplus-squared"></i></a>
</span>


    <span class='like'><a href="javascript:void(0)" title=""><i class="icon-heart-empty"></i> <span class="disqus-like-count"></span></a></span>
    <span class='view-code'><a href="javascript:void(0)" data-md="https://raw.githubusercontent.com/fooleap/fooleap.github.io/master/_posts/2015-12-04-show-exif-data-of-photo.md" title="在正文中查看源码"><i class="icon-file-code"></i>源码</a></span>
    <span class="number-of-word"><i class="icon-calc"></i>2381 字</span>
    <span class="page-tags"><i class="icon-tags"></i><ul class="tags"> <li class="tag"><a href="/tags.html#七牛" target="_blank" title="查看“七牛”的相关文章">七牛</a></li><li class="tag"><a href="/tags.html#Exif" target="_blank" title="查看“Exif”的相关文章">Exif</a></li><li class="tag"><a href="/tags.html#JavaScript" target="_blank" title="查看“JavaScript”的相关文章">JavaScript</a></li></ul></span>
  </div>

</article>

<div class="comment" id="disqus_thread">
    <a class="show-comments" href="http://127.0.0.1:4000/show-exif-data-of-photo#disqus_thread" data-disqus-identifier="/show-exif-data-of-photo"><span class="has-comment"><i class="icon-chat-empty"></i> 留下</span>评论 <span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:4000/show-exif-data-of-photo"></span></a>
</div>

  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  </body>
</html>

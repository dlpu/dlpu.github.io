<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>使用 Git 管理静态网站 | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="本博使用 GitHub Pages，很喜欢使用 Git 这种方式管理网站，下面就一起来看看如何使用 Git 来管理静态网站" />
    <meta name="keywords" content="Git, SSH, VPS" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://127.0.0.1:4000/using-git-to-manage-a-website" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          使用 Git 管理静态网站
        </h1>
        <h2 class="sub-heading">
            <i class="icon-calendar"></i><time datetime="2013-01-10">2013 年 01 月 10 日</time>
        </h2>
      </header>
  <article class="post-content">
    
  <div class="main-content">

<p>本博使用 GitHub Pages，很喜欢使用 Git 这种方式管理网站，下面就一起来看看如何使用 Git 来管理静态网站</p>

<p>以下参考这篇文章 <a href="http://toroid.org/ams/git-website-howto">Using Git to manage a web site</a></p>

<p>假设有一台 VPS，它的域名是 fooleap.org，我们可以通过 SSH 登录进行操作</p>

<p>先在服务器上创建一个新账户 git</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ssh root@fooleap.org 'adduser git'
</code></pre>
</div>

<p>###SSH 自动登录</p>

<p>使用公钥互信实现自动登录</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ssh git@fooleap.org 'mkdir .ssh'
$ ssh git@fooleap.org 'cat &gt;&gt; ~/.ssh/authorized_keys' &lt; ~/.ssh/id_rsa.pub
</code></pre>
</div>

<ul>
  <li>在服务器的 ~/.ssh/authorized_keys 文件添加本地公钥</li>
</ul>

<p>可以在本地的 ~/.ssh/config 文件定义 host git 对应的主机名及用户名</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.ssh/config</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>host git
hostname fooleap.org
user git</code></pre>

<p>经过这样处理之后，我们就可以通过 ssh git 自动登录服务器</p>

<p>###服务器端</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mkdir web.git &amp;&amp; cd web.git
$ git --bare init
</code></pre>
</div>

<ul>
  <li>初始化，添加 bare 参数是为了创建一个裸仓库，即不包含工作目录</li>
</ul>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>./hooks/post-receive</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>#!/bin/sh
GIT_WORK_TREE=~/web git checkout -f</code></pre>

<div class="highlighter-rouge"><pre class="highlight"><code>$ chmod +x hooks/post-receive
</code></pre>
</div>

<ul>
  <li>在挂钩目录 hooks 下创建一个 post-receive 文件，并赋予它可执行权限</li>
</ul>

<p><strong>这么做的作用是什么呢？</strong></p>

<p>当我们在本地执行推送后，会自动执行这个脚本，将 ~/web 这个目录作为工作目录并进行 checkout 操作</p>

<pre><code>$ cd &amp;&amp; mkdir web </code></pre>

<ul>
  <li>创建工作目录，这个目录可通过 Nginx 等设置对其访问</li>
</ul>

<p>为用户 git 指定一个专用的 shell</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>/etc/passwd</code></pre>
<pre style="margin-top: 0; border-top:.1rem dashed #ccc; padding-top:8px;"><code>- git:x:1001:1000:,,,:/home/git:/bin/bash
+ git:x:1001:1000:,,,:/home/git:/usr/bin/git-shell</code></pre>

<ul>
  <li>将默认的 shell: bash 替换为 git-shell</li>
</ul>

<p>这是为多人管理网站做的准备，作为协作管理的权限</p>

<p>###客户端</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mkdir web &amp;&amp; cd web
$ git init
$ echo "Hello World" &gt; index.html
$ git add .
$ git commit -m "add index.html"
$ git remote add web git@fooleap.org:web.git
$ git push web +master:refs/heads/master
</code></pre>
</div>

<ul><li>初始化本地仓库，提交一个版本，添加远程仓库并推送</li></ul>

<p>以后我们就可以在使用 git 来维护静态网站，要更新服务器端的时候，只需轻轻一推</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git push web
</code></pre>
</div>

<p>鄙人外语能力不足，没法和原文一样详细描述，Git 的使用也是半桶屎，有哪里说错，还请指出</p>

<p><strong>参考资料</strong></p>

<ul>
  <li>typeof.net: <a href="http://typeof.net/mechanix/static-website-using-git-in-actions.html">实战：用 git 搭建静态网站</a></li>
  <li>Pro Git: <a href="http://git-scm.com/book/zh/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E6%9E%B6%E8%AE%BE%E6%9C%8D%E5%8A%A1%E5%99%A8">4.4 服务器上的 Git - 架设服务器</a> <a href="http://git-scm.com/book/zh/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git%E6%8C%82%E9%92%A9#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%8C%82%E9%92%A9">7.3 自定义 Git - Git 挂钩</a></li>
  <li>man githooks: <a href="http://www.kernel.org/pub/software/scm/git/docs/githooks.html#post-receive">githooks(5)</a></li>
</ul>

<p><strong>本文历史</strong></p>

<ul>
  <li>2013 年 01 月 10 日 完成初稿</li>
</ul>

  </div>

  <div id="posts">
    <div id="random-posts" class="posts">
      <strong>猜你喜欢</strong>
      <ul>
      </ul>
    </div>
  
    <div id="recent-posts" class="posts">
      <strong>最近更新</strong>
      <ul>
      
        <li><a href="/configuring-ip-address-by-specifying-gateway" title="配置特定 IP 地址走指定网关">配置特定 IP 地址走指定网关 </a></li>
      
        <li><a href="/add-google-satellite-layer-in-amap" title="高德地图 API 叠加谷歌地图图层">高德地图 API 叠加谷歌地图图层 </a></li>
      
        <li><a href="/from-codoon-to-nikeplus" title="将咕咚的数据导入到 Nike+">将咕咚的数据导入到 Nike+ </a></li>
      
        <li><a href="/the-influence-of-sports-apps" title="运动 APP 的作用">运动 APP 的作用 </a></li>
      
        <li><a href="/the-last-run-of-june" title="今年 6 月的最后一次跑步">今年 6 月的最后一次跑步 </a></li>
      
      </ul>
    </div>
  </div>

  <div id="info" class="tech">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://127.0.0.1:4000/using-git-to-manage-a-website" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=使用 Git 管理静态网站 | 殷东亮的博客 via @&amp;url=http://127.0.0.1:4000/using-git-to-manage-a-website&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://127.0.0.1:4000/using-git-to-manage-a-website&amp;title=使用 Git 管理静态网站 | 殷东亮的博客&amp;summary=本博使用 GitHub Pages，很喜欢使用 Git 这种方式管理网站，下面就一起来看看如何使用 Git 来管理静态网站&amp;site=http://127.0.0.1:4000"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1:4000/using-git-to-manage-a-website&amp;text=使用 Git 管理静态网站｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://127.0.0.1:4000/using-git-to-manage-a-website&amp;t=使用 Git 管理静态网站 | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://127.0.0.1:4000/using-git-to-manage-a-website"><i class="icon-gplus-squared"></i></a>
</span>


    <span class='like'><a href="javascript:void(0)" title=""><i class="icon-heart-empty"></i> <span class="disqus-like-count"></span></a></span>
    <span class='view-code'><a href="javascript:void(0)" data-md="https://raw.githubusercontent.com/fooleap/fooleap.github.io/master/_posts/2013-01-10-using-git-to-manage-a-website.md" title="在正文中查看源码"><i class="icon-file-code"></i>源码</a></span>
    <span class="number-of-word"><i class="icon-calc"></i>1506 字</span>
    <span class="page-tags"><i class="icon-tags"></i><ul class="tags"> <li class="tag"><a href="/tags.html#Git" target="_blank" title="查看“Git”的相关文章">Git</a></li><li class="tag"><a href="/tags.html#SSH" target="_blank" title="查看“SSH”的相关文章">SSH</a></li><li class="tag"><a href="/tags.html#VPS" target="_blank" title="查看“VPS”的相关文章">VPS</a></li></ul></span>
  </div>

</article>

<div class="comment" id="disqus_thread">
    <a class="show-comments" href="http://127.0.0.1:4000/using-git-to-manage-a-website#disqus_thread" data-disqus-identifier="/using-git-to-manage-a-website"><span class="has-comment"><i class="icon-chat-empty"></i> 留下</span>评论 <span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:4000/using-git-to-manage-a-website"></span></a>
</div>

  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  </body>
</html>

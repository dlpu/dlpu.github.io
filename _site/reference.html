<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>JavaScript 实现参考资料功能 | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="有些时候写博文会引用很多外部链接，如果这些外部链接全部放在文中感觉有些不妥，至少在美观度上就有些偏离大众审美。为了更好地引（zhuāng）用（bī），在工夫茶的二三事中，我致（chāo）敬（xí）维基百科，模仿了其使用参考资料的形式，感觉还不错（当然不错）。" />
    <meta name="keywords" content="参考资料, Reference, JavaScript, Jekyll" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://127.0.0.1:4000/reference" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          JavaScript 实现参考资料功能
        </h1>
        <h2 class="sub-heading">
            <i class="icon-calendar"></i><time datetime="2015-09-16">2015 年 09 月 16 日</time>
        </h2>
      </header>
  <article class="post-content">
    
  <div class="main-content">
<ul id="toc">
  <li><a href="#id-section" id="markdown-toc-id-section">功能介绍</a></li>
  <li><a href="#id-section-1" id="markdown-toc-id-section-1">点击链接跳转</a></li>
  <li><a href="#id-section-2" id="markdown-toc-id-section-2">目标背景高亮</a></li>
  <li><a href="#id-section-3" id="markdown-toc-id-section-3">自动生成参考资料</a></li>
  <li><a href="#id-section-4" id="markdown-toc-id-section-4">参考资料</a></li>
</ul>

<p>有些时候写博文会引用很多外部链接，如果这些外部链接全部放在文中感觉有些不妥，至少在美观度上就有些偏离大众审美。为了更好地引（zhuāng）用（bī），在 <a href="gongfu-tea.html">工夫茶的二三事</a> 中，我致（chāo）敬（xí）维基百科，模仿了其使用参考资料的形式，感觉还不错（当然不错）。</p>

<p>在 <a href="disqus-comment-count.html">显示 Disqus 评论计数</a> 的评论中，菠萝格格<a href="http://www.daquan8.com/" title="博客志">[1]</a> 建议说下这方面，仔细想想也有挺多可以讲的，遂记于此。</p>

<h2 id="id-section">功能介绍</h2>

<p>从下图我们可以看到，维基百科的参考资料，最基本的功能就是点击上标数字可以跳转到参考资料区对应的条目并高亮，且参考资料链接前还有可以点击返回的链接，其次是鼠标焦点位于上标数字时会显示一个框框，里面有对应的链接。</p>

<p><img src="http://source.fooleap.org/reference.gif" alt="维基百科的参考资料功能" />
▲维基百科的参考资料功能</p>

<p>分解出来，基本功能的实现大概有以下几点：</p>

<ol>
  <li>点击链接跳转</li>
  <li>目标背景高亮</li>
  <li>鼠标覆盖显示浮框</li>
</ol>

<p>虽然浮框功能挺好的，但老衲感觉还是略显浮（má）夸（fán），所以这里主要讲一下前面两个功能。</p>

<h2 id="id-section-1">点击链接跳转</h2>

<p>页内链接的跳转，能想到的就是 HTML 的锚点链接，看看文档<a href="http://www.w3.org/TR/html401/struct/links.html#h-12.1.3" title="Specifying anchors and links">[2]</a>，一般可以使用 <code class="highlighter-rouge">name</code> 或 <code class="highlighter-rouge">id</code> 属性实现，目前一般习惯用 <code class="highlighter-rouge">id</code>，CSS 以及 JavaScript 的选择处理起来更加比较方便。</p>

<p>上标数字在 HTML 中则使用 <code class="highlighter-rouge">&lt;sup&gt;</code> 元素，那么参考资料点击跳转使用 HTML 的写法如下：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- &lt;sup&gt; 在外面更利于 CSS 的定义 --&gt;</span>
那一天，我在街上看到了条狗<span class="nt">&lt;sup&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#note-1"</span> <span class="na">id=</span><span class="s">"ref-1"</span><span class="nt">&gt;</span>[1]<span class="nt">&lt;/a&gt;&lt;/sup&gt;</span>，后来发现居然是只狼<span class="nt">&lt;sup&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#note-2"</span> <span class="na">id=</span><span class="s">"ref-2"</span><span class="nt">&gt;</span>[2]<span class="nt">&lt;/a&gt;&lt;/sup&gt;</span>。

<span class="nt">&lt;h2&gt;</span>参考资料<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#ref-1"</span><span class="nt">&gt;</span>∧<span class="nt">&lt;/a&gt;</span> <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://zh.wikipedia.org/wiki/狗"</span> <span class="na">id=</span><span class="s">"note-1"</span> <span class="na">target=</span><span class="s">"_blank"</span><span class="nt">&gt;</span>狗 - 维基百科<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#ref-2"</span><span class="nt">&gt;</span>∧<span class="nt">&lt;/a&gt;</span> <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://zh.wikipedia.org/wiki/狼"</span> <span class="na">id=</span><span class="s">"note-2"</span> <span class="na">target=</span><span class="s">"_blank"</span><span class="nt">&gt;</span>狼 - 维基百科<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span></code></pre></figure>

<p>如果和我一样使用 Markdown 写作，并采用 kramdown 作为解析器<a href="http://kramdown.gettalong.org/" title="kramdown">[3]</a>，可以这么写：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">那一天，我在街上看到了条狗<span class="nt">&lt;sup&gt;</span>[[1]](#note-1){:id="ref-1"}<span class="nt">&lt;/sup&gt;</span>，后来发现居然是只狼<span class="nt">&lt;sup&gt;</span>[[2]](#note-2){:id="ref-2"}<span class="nt">&lt;/sup&gt;</span>。

## 参考资料

1. [∧](#ref-1) [狗 - 维基百科](https://zh.wikipedia.org/wiki/狗){:id="note-1" target="_blank"}
2. [∧](#ref-2) [狼 - 维基百科](https://zh.wikipedia.org/wiki/狼){:id="note-2" target="_blank"}</code></pre></figure>

<p>以上用笨方法实现了链接点击页内的功能，点击 <sup><code class="highlighter-rouge">[数字]</code></sup> 就会跳到下面对应的参考资料位置，点击 <code class="highlighter-rouge">∧</code> 则可以返回引用参考资料所在的位置。</p>

<h2 id="id-section-2">目标背景高亮</h2>

<p>点击链接高亮目标，似乎这功能离不开 JavaScript。仔细看发现维基百科高亮的不是目标本身，而是目标的父元素。上面的 HTML 写得刚好，一上一下父元素分别是 <code class="highlighter-rouge">&lt;sup&gt;</code> 以及 <code class="highlighter-rouge">&lt;li&gt;</code>，使用起来刚好合适。</p>

<p>目标背景高亮可以采用使用广泛的 jQuery 实现：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 选择相关链接，使用正则匹配
</span>
<span class="kd">var</span> <span class="nx">noteLinks</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'a[href^="#note"], a[href^="#ref"]'</span><span class="p">);</span>
<span class="nx">noteLinks</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="c1">// 清除背景颜色
</span>
  <span class="nx">noteLinks</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">'background-color'</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
  <span class="c1">// 高亮目标背景
</span>
  <span class="kd">var</span> <span class="nx">href</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'href'</span><span class="p">);</span> 
  <span class="nx">$</span><span class="p">(</span><span class="nx">href</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">'background-color'</span><span class="p">,</span> <span class="s1">'rgb(235, 235, 235)'</span><span class="p">);</span> 
<span class="p">})</span></code></pre></figure>

<p>原生 JavaScript 可以这么实现：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 选择相关链接，使用正则匹配
</span>
<span class="kd">var</span> <span class="nx">noteLinks</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'a[href^="#note"], a[href^="#ref"]'</span><span class="p">);</span>
<span class="kd">function</span> <span class="nx">linkFocus</span> <span class="p">(){</span>
  <span class="c1">// 清除背景颜色
</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">noteLinks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span> <span class="p">){</span>
    <span class="nx">noteLinks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 高亮目标背景
</span>
  <span class="kd">var</span> <span class="nx">href</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'#'</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">href</span><span class="p">).</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">'rgb(235, 235, 235)'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">noteLinks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span>  <span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">noteLinks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">noteLinks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="nx">linkFocus</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">noteLinks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">linkFocus</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>至于 IE 兼容，只想说先一边去，不出错就好，兼容到 IE8。</p>

<h2 id="id-section-3">自动生成参考资料</h2>

<p>点击链接跳转实现了，目标背景高亮也实现了，但看起来好像有点不对劲。人总是懒的，每次写参考资料都要那么写，多少个 <code class="highlighter-rouge">&lt;sup&gt;</code>、<code class="highlighter-rouge">&lt;li&gt;</code> 向你招手，岂不累死？能不能自动生成参考资料？答案自然是肯定的，使用 JavaScript 就可以实现。</p>

<p>看前面写的 HTML，规则的东西不少，例如 <code class="highlighter-rouge">&lt;sup&gt;</code> 每次引用链接都会出现，<code class="highlighter-rouge">&lt;li&gt;</code>、<code class="highlighter-rouge">∧</code> 等也一样都是重复出现，而 <code class="highlighter-rouge">#note-*</code>、<code class="highlighter-rouge">#ref-*</code> 等则是有规律的出现，那这些东西应该可以不用再写，直接采用 JavaScript 生成就行。</p>

<p>HTML 部分可简化如下：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">那一天，我在街上看到了条狗<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://zh.wikipedia.org/wiki/狗"</span> <span class="na">title=</span><span class="s">"狗 - 维基百科"</span><span class="nt">&gt;</span>[1]<span class="nt">&lt;/a&gt;</span>，后来发现居然是只狼<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://zh.wikipedia.org/wiki/狼"</span> <span class="na">title=</span><span class="s">"狼 - 维基百科"</span><span class="nt">&gt;</span>[2]<span class="nt">&lt;/a&gt;</span>。

<span class="nt">&lt;h2&gt;</span>参考资料<span class="nt">&lt;/h2&gt;</span></code></pre></figure>

<p>使用更方便的 Markdown：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">那一天，我在街上看到了条狗[[1]](https://zh.wikipedia.org/wiki/狗){:title="狗 - 维基百科"}，后来发现居然是只狼[[2]](https://zh.wikipedia.org/wiki/狼){:title="狼 - 维基百科"}。

## 参考资料</code></pre></figure>

<p>哦，对了，Markdown 本身可以以参考式链接形式写链接<a href="http://daringfireball.net/projects/markdown/syntax#link" title="Links - Markdown: Syntax">[4]</a>，可以更形象地装逼。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">那一天，我在街上看到了条狗[[1]] [1]，后来发现居然是只狼[[2]] [2]。

## 参考资料

[1]: https://zh.wikipedia.org/wiki/狗 "狗 - 维基百科"
[2]: https://zh.wikipedia.org/wiki/狼 "狼 - 维基百科"</code></pre></figure>

<p>采用 jQuery：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">last</span><span class="p">().</span><span class="nx">html</span><span class="p">()</span> <span class="o">===</span> <span class="s1">'参考资料'</span><span class="p">){</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">last</span><span class="p">().</span><span class="nx">after</span><span class="p">(</span><span class="s1">'&lt;ol id="refs"&gt;&lt;/ol&gt;'</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 选择非本站链接
</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'a[href*="http:"]:not([href*="'</span> <span class="o">+</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s1">'"]), [href*="https:"]:not([href*="'</span> <span class="o">+</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s1">'"])'</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="c1">// 去掉所选链接文本的最前、最后字符
</span>
  <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">().</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="c1">// 判断是否为数字
</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">num</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">note</span> <span class="o">=</span> <span class="s1">'note-'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s1">'ref-'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">noteTitle</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'title'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">noteHref</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'href'</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span><span class="na">href</span><span class="p">:</span> <span class="s1">'#'</span> <span class="o">+</span> <span class="nx">note</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="nx">ref</span><span class="p">,</span> <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'ref'</span><span class="p">}).</span><span class="nx">wrap</span><span class="p">(</span><span class="s1">'&lt;sup&gt;'</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'#refs'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">'&lt;li class="note"&gt;&lt;a href="#'</span><span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s1">'"&gt;&amp;and;&lt;/a&gt; &lt;a href="'</span><span class="o">+</span> <span class="nx">noteHref</span> <span class="o">+</span> <span class="s1">'" title="'</span> <span class="o">+</span> <span class="nx">noteTitle</span> <span class="o">+</span> <span class="s1">'" id="'</span> <span class="o">+</span> <span class="nx">note</span> <span class="o">+</span><span class="s1">'" class="exf-text" target="_blank"&gt;'</span> <span class="o">+</span> <span class="nx">noteTitle</span> <span class="o">+</span> <span class="s1">'&lt;/a&gt;&lt;/li&gt;'</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 不是数字保留并加上 target 属性
</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'target'</span><span class="p">,</span> <span class="s1">'_blank'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="kd">var</span> <span class="nx">noteLinks</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'a[href^="#note"], a[href^="#ref"]'</span><span class="p">);</span>
<span class="nx">noteLinks</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="c1">// 清除背景颜色
</span>
  <span class="nx">noteLinks</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">'background-color'</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
  <span class="c1">// 高亮目标背景
</span>
  <span class="kd">var</span> <span class="nx">href</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'href'</span><span class="p">);</span> 
  <span class="nx">$</span><span class="p">(</span><span class="nx">href</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">'background-color'</span><span class="p">,</span> <span class="s1">'rgb(235, 235, 235)'</span><span class="p">);</span> 
<span class="p">})</span></code></pre></figure>

<p>JavaScript 原生：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">links</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">)[</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">===</span> <span class="s1">'参考资料'</span><span class="p">){</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">)[</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">'afterend'</span><span class="p">,</span> <span class="s1">'&lt;ol id="refs"&gt;&lt;/ol&gt;'</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">links</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 选择非本站链接
</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">hostname</span> <span class="o">!=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">&amp;&amp;</span> <span class="sr">/^javascript/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">href</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">){</span>
    <span class="c1">// 去掉所选链接文本的最前、最后字符
</span>
    <span class="kd">var</span> <span class="nx">numText</span> <span class="o">=</span> <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="nx">numText</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">numText</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="c1">// 判断是否为数字
</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">num</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">note</span> <span class="o">=</span> <span class="s1">'note-'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s1">'ref-'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">noteTitle</span> <span class="o">=</span> <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'title'</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">noteHref</span> <span class="o">=</span> <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">);</span>
      <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">,</span> <span class="s1">'#'</span> <span class="o">+</span> <span class="nx">note</span><span class="p">);</span>
      <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nx">ref</span><span class="p">);</span>
      <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'ref'</span><span class="p">);</span>
      <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">outerHTML</span> <span class="o">=</span> <span class="s1">'&lt;sup&gt;'</span> <span class="o">+</span> <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">outerHTML</span> <span class="o">+</span> <span class="s1">'&lt;/sup&gt;'</span><span class="p">;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'refs'</span><span class="p">).</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">'beforeend'</span><span class="p">,</span> <span class="s1">'&lt;li class="note"&gt;&lt;a href="#'</span><span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s1">'"&gt;&amp;and;&lt;/a&gt; &lt;a href="'</span><span class="o">+</span> <span class="nx">noteHref</span> <span class="o">+</span> <span class="s1">'" title="'</span> <span class="o">+</span> <span class="nx">noteTitle</span> <span class="o">+</span> <span class="s1">'" id="'</span> <span class="o">+</span> <span class="nx">note</span> <span class="o">+</span><span class="s1">'" class="exf-text" target="_blank"&gt;'</span> <span class="o">+</span> <span class="nx">noteTitle</span> <span class="o">+</span> <span class="s1">'&lt;/a&gt;&lt;/li&gt;'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 不是数字保留并加上 target 属性
</span>
      <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'target'</span><span class="p">,</span> <span class="s1">'_blank'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 选择相关链接，使用正则匹配
</span>
<span class="kd">var</span> <span class="nx">noteLinks</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'a[href^="#note"], a[href^="#ref"]'</span><span class="p">);</span>
<span class="kd">function</span> <span class="nx">linkFocus</span> <span class="p">(){</span>
  <span class="c1">// 清除背景颜色
</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">noteLinks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span> <span class="p">){</span>
    <span class="nx">noteLinks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 高亮目标背景
</span>
  <span class="kd">var</span> <span class="nx">href</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'#'</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">href</span><span class="p">).</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">'rgb(235, 235, 235)'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">noteLinks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span>  <span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">noteLinks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">noteLinks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="nx">linkFocus</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">noteLinks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">linkFocus</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>看百度百科的参考资料还多了网站标题，引用日期等等，这也可以采用自定义属性<a href="http://www.w3school.com.cn/tags/att_global_data.asp" title="HTML data-* 属性">[5]</a>，一小博客就不瞎起劲。</p>

<p>站外链接后面的图标则可以通过 CSS 定义，例如：</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">a</span><span class="o">[</span><span class="nt">target</span><span class="o">=</span><span class="s1">"_blank"</span><span class="o">]</span><span class="nd">:after</span> <span class="p">{</span>
  <span class="nl">content</span><span class="p">:</span> <span class="s2">'↗'</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>以上 JS 示例: http://runjs.cn/detail/kgsa53l1</p>

<iframe style="width: 100%; height: 300px" src="http://sandbox.runjs.cn/show/kgsa53l1" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>另外，本文就是使用自动生成参考资料的方式来书写，戳左下角“源码”按钮即可查看 Markdown 源码，如果没看到“源码”按钮，那么该换浏览器了。</p>

<h2 id="id-section-4">参考资料</h2>

<p><strong>本文历史</strong></p>

<ul>
  <li>2015 年 09 月 16 日 完成初稿</li>
</ul>

  </div>

  <div id="posts">
    <div id="random-posts" class="posts">
      <strong>猜你喜欢</strong>
      <ul>
      </ul>
    </div>
  
    <div id="recent-posts" class="posts">
      <strong>最近更新</strong>
      <ul>
      
        <li><a href="/configuring-ip-address-by-specifying-gateway" title="配置特定 IP 地址走指定网关">配置特定 IP 地址走指定网关 </a></li>
      
        <li><a href="/add-google-satellite-layer-in-amap" title="高德地图 API 叠加谷歌地图图层">高德地图 API 叠加谷歌地图图层 </a></li>
      
        <li><a href="/from-codoon-to-nikeplus" title="将咕咚的数据导入到 Nike+">将咕咚的数据导入到 Nike+ </a></li>
      
        <li><a href="/the-influence-of-sports-apps" title="运动 APP 的作用">运动 APP 的作用 </a></li>
      
        <li><a href="/the-last-run-of-june" title="今年 6 月的最后一次跑步">今年 6 月的最后一次跑步 </a></li>
      
      </ul>
    </div>
  </div>

  <div id="info" class="tech">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://127.0.0.1:4000/reference" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=JavaScript 实现参考资料功能 | 殷东亮的博客 via @&amp;url=http://127.0.0.1:4000/reference&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://127.0.0.1:4000/reference&amp;title=JavaScript 实现参考资料功能 | 殷东亮的博客&amp;summary=有些时候写博文会引用很多外部链接，如果这些外部链接全部放在文中感觉有些不妥，至少在美观度上就有些偏离大众审美。为了更好地引（zhuāng）用（bī），在工夫茶的二三事中，我致（chāo）敬（xí）维基百科，模仿了其使用参考资料的形式，感觉还不错（当然不错）。&amp;site=http://127.0.0.1:4000"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1:4000/reference&amp;text=JavaScript 实现参考资料功能｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://127.0.0.1:4000/reference&amp;t=JavaScript 实现参考资料功能 | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://127.0.0.1:4000/reference"><i class="icon-gplus-squared"></i></a>
</span>


    <span class='like'><a href="javascript:void(0)" title=""><i class="icon-heart-empty"></i> <span class="disqus-like-count"></span></a></span>
    <span class='view-code'><a href="javascript:void(0)" data-md="https://raw.githubusercontent.com/fooleap/fooleap.github.io/master/_posts/2015-09-16-reference.md" title="在正文中查看源码"><i class="icon-file-code"></i>源码</a></span>
    <span class="number-of-word"><i class="icon-calc"></i>6864 字</span>
    <span class="page-tags"><i class="icon-tags"></i><ul class="tags"> <li class="tag"><a href="/tags.html#参考资料" target="_blank" title="查看“参考资料”的相关文章">参考资料</a></li><li class="tag"><a href="/tags.html#Reference" target="_blank" title="查看“Reference”的相关文章">Reference</a></li><li class="tag"><a href="/tags.html#JavaScript" target="_blank" title="查看“JavaScript”的相关文章">JavaScript</a></li><li class="tag"><a href="/tags.html#Jekyll" target="_blank" title="查看“Jekyll”的相关文章">Jekyll</a></li></ul></span>
  </div>

</article>

<div class="comment" id="disqus_thread">
    <a class="show-comments" href="http://127.0.0.1:4000/reference#disqus_thread" data-disqus-identifier="/reference"><span class="has-comment"><i class="icon-chat-empty"></i> 留下</span>评论 <span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:4000/reference"></span></a>
</div>

  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  </body>
</html>

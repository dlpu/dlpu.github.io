<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>KML 路径坐标转换器 | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="可将 Google Earth/Maps 导出的 KML 转换成高德或百度地图 JS API 用坐标集。" />
    <meta name="keywords" content="百度坐标, GPS 坐标, 火星坐标, WGS-84, GCJ-02, BD-09, Google Earth, Google Maps" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://yindongliang.com/google-kml-path-coord-converter/" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <style type="text/css">
input[type="file"] {
    display: none;
}
#output{
    display: block;
    width: 100%;
	height: 375px;
    margin: 0;
	font-size: 12px;
	font-family: sans-serif;
}
#coordtransform {
    line-height: 20px;
    margin: 5px 0;
}
#coordtransform label{
    padding-left: 20px;
    line-height: 25px;
    display: inline-block;
}
#coordtransform #filename{
    padding: 0;
	font-size: 12px;
}
#coordtransform .file-upload,#coordtransform  button{
  display: inline-block;
  background-color: #f8f8f8;
  border: 1px solid #e0e0e0;
  padding: 2px 8px;
  line-height: 15px;
  font-size: 12px;
  cursor: pointer;
}
#coordtransform input[type=radio]{
    display: none;
}
#coordtransform .radio-input {
    position: relative;
    display: inline-block;
    width: 12px;
    height: 12px;
    margin: 0 2px 0 -14px;
    vertical-align: middle;
    border: 1px solid #dcdcdc;
    -webkit-border-radius: 10px;
    border-radius: 10px;
    background-color: #fff;
}
#coordtransform input[type=radio]:checked + .radio-input:after {
    position: absolute;
    top: 0;
    left: 0;
    width: 8px;
    height: 8px;
    margin: 2px;
    content: '';
    border: 0;
    -webkit-border-radius: 8px;
    border-radius: 8px;
    background-color: #999;
}
</style>
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/links.html" class="navigation-item"><i class="icon-link"></i>链接</a></li>
          <li><a href="/guestbook.html" class="navigation-item"><i class="icon-chat"></i>留言本</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          KML 路径坐标转换器
        </h1>
        <h2 class="sub-heading">
            可将 Google Earth/Maps 导出的 KML 转换成高德或百度地图 JS API 用坐标集。
        </h2>
      </header>
  
  
  
  <article class="post-content">
  <div id="coordtransform">
<label class="file-upload">
    <input type="file" id="kml-input" />
    选择文件
</label>
<label id="filename"></label>
<label><input type="radio" name="coordtrans" id="togcj02" value="to GCJ02" checked="" /><span class="radio-input"></span>to GCJ02</label>
<label><input type="radio" name="coordtrans" id="tobd09" value="to BD09" /><span class="radio-input"></span>to BD09</label>
<label><button id="submit">提交</button></label>
</div>
<textarea id="output"></textarea>




  <div id="info" class="">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://yindongliang.com/google-kml-path-coord-converter/" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=KML 路径坐标转换器 | 殷东亮的博客 via @&amp;url=http://yindongliang.com/google-kml-path-coord-converter/&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yindongliang.com/google-kml-path-coord-converter/&amp;title=KML 路径坐标转换器 | 殷东亮的博客&amp;summary=可将 Google Earth/Maps 导出的 KML 转换成高德或百度地图 JS API 用坐标集。&amp;site=http://yindongliang.com"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://yindongliang.com/google-kml-path-coord-converter/&amp;text=KML 路径坐标转换器｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://yindongliang.com/google-kml-path-coord-converter/&amp;t=KML 路径坐标转换器 | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://yindongliang.com/google-kml-path-coord-converter/"><i class="icon-gplus-squared"></i></a>
</span>


  </div>
</article>

  
  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  <script type="text/javascript" src="/assets/js/coordtransform.js"></script>
  <script type="text/javascript">
  
var gps, gpsArrays, contents;
function coord(type){
    var jsonContents = JSON.parse(contents).metrics;
    for(var i = 0; i < jsonContents.length;i++){
        if(jsonContents[i].type == type){
            return i;
        }
    }
}
function readKML(event) {
    var file = event.target.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
		    contents = e.target.result;
            gps = [];
            gpsArrays = [];
            if (file.type == 'application/vnd.google-earth.kml+xml') {
                var contentsArray = contents.split('</tessellate>');
                for (var i = 1; i <= contentsArray.length - 1; i++) {
                    gpspoints = contentsArray[i].split('<coordinates>')[1].split('</coordinates>')[0].replace(/^\s+|\s+$|\.0/g, '');
                    gps.push(gpspoints.substring(0, gpspoints.length - 2).split(',0 '));
                }
                for (var i = 0; i < gps.length; i++) {
                    gpsArrays[i] = [];
                    for (var e in gps[i]) {
                        gpsArrays[i][e] = {
                            'lng': parseFloat(gps[i][e].split(',')[0]),
                            'lat': parseFloat(gps[i][e].split(',')[1])
                        }
                    }
                }
            } else if (contents.indexOf('nike') > -1) {
                    gpsArrays[0] = [];
                    // api v3
                    jsonContents = JSON.parse(contents).metrics;
                    var lng = coord('longitude');
                    var lat = coord('latitude');
                    for(var i = 0; i < jsonContents[lng].values.length; i++) {
                    gpsArrays[0][i] = {
                        'lng': parseFloat(jsonContents[lng].values[i].value),
                        'lat': parseFloat(jsonContents[lat].values[i].value)
                    }
                    /** api v1
                     *for(var i = 0; i < JSON.parse(contents).waypoints.length; i++) {
                     *gpsArrays[0].push({
                     *    'lng': parseFloat(JSON.parse(contents).waypoints[i].longitude),
                     *    'lat': parseFloat(JSON.parse(contents).waypoints[i].latitude)
                     *})
                     */
                }
            } else {
                alert("请选择正确格式文件！");
				return;
            }
			document.getElementById('filename').innerHTML = file.name;
			document.getElementById('output').innerHTML = contents;
        }
        reader.readAsText(file);
    } else {
        alert("读取失败");
    }
}
function transform() {
    var gcj02Arrays = [];
    var bd09Arrays = [];
    var output = '';
    var result = [];
    for (var i in gpsArrays) {
        gcj02Arrays[i] = [];
        if (contents.indexOf('xmlns:gx') > -1 || contents.indexOf('nike') > -1){
            result[i] = [];
            for (var e in gpsArrays[i]) {
                result[i].push(coordtransform.wgs84togcj02(gpsArrays[i][e].lng, gpsArrays[i][e].lat));
                result[i][e] = result[i][e].toString().split(',');
                gcj02Arrays[i].push({
                    'lng': result[i][e][0],
                    'lat': result[i][e][1]
                });
            }
        } else {
            gcj02Arrays[i] = gpsArrays[i];
        }
    }
    if (document.getElementById('togcj02').checked == true) {
        for (var i = 0; i < gcj02Arrays.length; i++) {
            var lineNo = gcj02Arrays.length == 1 ? '': i.toString();
            output += 'var lineArr' + lineNo + ' = [\n';
            for (var e in gcj02Arrays[i]) {
                output += '  [' + parseFloat(gcj02Arrays[i][e].lng).toFixed(14) + ', ' + parseFloat(gcj02Arrays[i][e].lat).toFixed(14) + '],\n';
            }
            output = output.substring(0, output.length -2 ) + '\n];\n';
        }
    }
    if (document.getElementById('tobd09').checked == true) {
        for (var i in gcj02Arrays) {
            bd09Arrays[i] = [];
            result[i] = [];
            for (var e in gcj02Arrays[i]) {
                result[i].push(coordtransform.gcj02tobd09(gcj02Arrays[i][e].lng, gcj02Arrays[i][e].lat));
                result[i][e] = result[i][e].toString().split(',');
                bd09Arrays[i].push({
                    'lng': result[i][e][0],
                    'lat': result[i][e][1]
                });
            }
        }
        for (var i = 0; i < bd09Arrays.length; i++) {
            var lineNo = bd09Arrays.length == 1 ? '': i.toString();
            output += 'var points' + lineNo + ' = [\n';
            for (var e in bd09Arrays[i]) {
                output += '  new BMap.Point(' + parseFloat(bd09Arrays[i][e].lng).toFixed(14) + ', ' + parseFloat(bd09Arrays[i][e].lat).toFixed(14) + '),\n';
            }
            output = output.substring(0, output.length - 2) + '\n];\n';
        }
    }
    document.getElementById('output').innerHTML = output;
}
document.getElementById('kml-input').addEventListener('change', readKML, false);
document.getElementById('submit').addEventListener('click', transform, false);
</script>
  </body>
</html>

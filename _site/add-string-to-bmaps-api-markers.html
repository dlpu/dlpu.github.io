<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>给地图标注加上字符 | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="在地图中，显示多个地点的时候，想要更好的区分，往往会使用不同样式的地点图标，或改变图标的形状，或改变图标的颜色，或在图标上加上字符。论其成本，恐怕在原有地点图标上加上字符是最低的，添加字符相对来说也更利于区分。" />
    <meta name="keywords" content="百度地图 API, 标注, JavaScript" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://127.0.0.1:4000/add-string-to-bmaps-api-markers" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <style type="text/css">
    .map{max-width:640px;width:100%;height:384px}
    </style>
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          给地图标注加上字符
        </h1>
        <h2 class="sub-heading">
            <i class="icon-calendar"></i><time datetime="2015-10-08">2015 年 10 月 08 日</time>
        </h2>
      </header>
  
  
  
  <article class="post-content">
    
  <div class="main-content">
<ul id="toc">
  <li><a href="#id-section" id="markdown-toc-id-section">单张图片</a></li>
  <li><a href="#id-image-sprites" id="markdown-toc-id-image-sprites">通过 Image Sprites</a></li>
  <li><a href="#id-html5-canvas" id="markdown-toc-id-html5-canvas">通过 HTML5 Canvas</a></li>
  <li><a href="#id-api" id="markdown-toc-id-api">通过七牛 API</a>    <ul>
      <li><a href="#id-section-1" id="markdown-toc-id-section-1">图片水印</a></li>
      <li><a href="#id-section-2" id="markdown-toc-id-section-2">裁剪图片</a></li>
    </ul>
  </li>
  <li><a href="#id-section-3" id="markdown-toc-id-section-3">几种方式的对比</a></li>
  <li><a href="#id-section-4" id="markdown-toc-id-section-4">覆盖物素材</a></li>
  <li><a href="#id-section-5" id="markdown-toc-id-section-5">参考资料</a></li>
</ul>

<p>在地图中，显示多个地点的时候，想要更好的区分，往往会使用不同样式的地点图标，或改变图标的形状，或改变图标的颜色，或在图标上加上字符。论其成本，恐怕在原有地点图标上加上字符是最低的，添加字符相对来说也更利于区分。</p>

<p>百度地图 API 是采用 Icon 类来修改覆盖物，使用上 Marker 来完成标注的覆盖<a href="http://developer.baidu.com/map/reference/index.php?title=Class:覆盖物类/Icon" title="Class:覆盖物类/Icon - 百度地图API">[1]</a><a href="http://developer.baidu.com/map/reference/index.php?title=Class:覆盖物类/Marker" title="Class:覆盖物类/Marker - 百度地图API">[2]</a>，可以用以下几种方式来实现加载带有数字或字母的 Marker。</p>

<h2 id="id-section">单张图片</h2>

<p>这是最没办法的办法，一个一个来，先放代码，后放示例。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"http://api.map.baidu.com/api?v=2.0&amp;ak=您的密钥"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"map"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s1">'map'</span><span class="p">);</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">centerAndZoom</span><span class="p">(</span><span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="mf">116.4</span><span class="p">,</span> <span class="mf">23.4</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mf">11.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">icons</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">markers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">icons</span> <span class="o">=</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Icon</span><span class="p">(</span><span class="s1">'http://7fv9cr.com1.z0.glb.clouddn.com/marker_a.png'</span><span class="p">,</span> <span class="nx">size1</span><span class="p">,</span> <span class="p">{</span><span class="na">anchor</span><span class="p">:</span> <span class="nx">size2</span> <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Icon</span><span class="p">(</span><span class="s1">'http://7fv9cr.com1.z0.glb.clouddn.com/marker_b.png'</span><span class="p">,</span> <span class="nx">size1</span><span class="p">,</span> <span class="p">{</span><span class="na">anchor</span><span class="p">:</span> <span class="nx">size2</span> <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Icon</span><span class="p">(</span><span class="s1">'http://7fv9cr.com1.z0.glb.clouddn.com/marker_c.png'</span><span class="p">,</span> <span class="nx">size1</span><span class="p">,</span> <span class="p">{</span><span class="na">anchor</span><span class="p">:</span> <span class="nx">size2</span> <span class="p">})</span>
  <span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="s1">'116.'</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">()),</span> <span class="mf">23.4</span><span class="p">);</span>
    <span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="p">{</span><span class="na">icon</span><span class="p">:</span> <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]});</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addOverlay</span><span class="p">(</span><span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span></code></pre></figure>

<div class="map" id="map1"></div>

<h2 id="id-image-sprites">通过 Image Sprites</h2>

<p>既然是图片，那么可以使用类似于 CSS Image Sprites<a href="http://www.w3schools.com/css/css_image_sprites.asp" title="CSS Image Sprites">[3]</a> 的方法来加载，通过 Icon 类 的 imageOffset 属性可以实现，具体如下：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"http://api.map.baidu.com/api?v=2.0&amp;ak=您的密钥"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"map"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s1">'map'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mf">11.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">centerAndZoom</span><span class="p">(</span><span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="mf">116.4</span><span class="p">,</span> <span class="mf">23.4</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">icons</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">markers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="s1">'116.'</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">()),</span> <span class="mf">23.4</span><span class="p">);</span>
    <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Icon</span><span class="p">(</span><span class="s1">'http://7fv9cr.com1.z0.glb.clouddn.com/markers.png'</span><span class="p">,</span> <span class="nx">size1</span><span class="p">,</span> <span class="p">{</span><span class="na">anchor</span><span class="p">:</span> <span class="nx">size2</span><span class="p">,</span> <span class="na">imageOffset</span><span class="p">:</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">25</span><span class="p">)});</span>
    <span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="p">{</span><span class="na">icon</span><span class="p">:</span> <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]});</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addOverlay</span><span class="p">(</span><span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span></code></pre></figure>

<div class="map" id="map2"></div>

<h2 id="id-html5-canvas">通过 HTML5 Canvas</h2>

<p>另外，也可通过 HTML5 的 Canvas 在图片里添加文字达到标注上加文字的效果，具体可参考台湾同胞的文章——利用 Canvas 製作 Google Maps API Marker Icon<a href="http://blog.xuite.net/vexed/tech/59848483" title="利用 Canvas 製作 Google Maps API Marker Icon @ Vexed's Blog">[4]</a>。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"http://api.map.baidu.com/api?v=2.0&amp;ak=您的密钥"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"map"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s1">'map'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mf">11.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">letter</span><span class="p">,</span>
      <span class="nx">points</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">icons</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">markers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">centerAndZoom</span><span class="p">(</span><span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="mf">116.4</span><span class="p">,</span> <span class="mf">23.4</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
  <span class="nx">image</span><span class="p">.</span><span class="nx">crossOrigin</span> <span class="o">=</span> <span class="s1">'*'</span><span class="p">;</span>
  <span class="nx">image</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">letter</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">71</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'canvas'</span><span class="p">);</span>
          <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
          <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">'2d'</span><span class="p">);</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">textAlign</span> <span class="o">=</span> <span class="s1">'center'</span><span class="p">;</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s1">'bold 10px sans-serif'</span><span class="p">;</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">'#ffffff'</span><span class="p">;</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">letter</span><span class="p">),</span> <span class="mf">9.5</span><span class="p">,</span> <span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
      <span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="s1">'116.'</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">()),</span> <span class="mf">23.4</span><span class="p">);</span>
      <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Icon</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(),</span> <span class="nx">size1</span><span class="p">,</span> <span class="p">{</span><span class="na">anchor</span><span class="p">:</span> <span class="nx">size2</span><span class="p">});</span>
      <span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="p">{</span><span class="na">icon</span><span class="p">:</span> <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]});</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addOverlay</span><span class="p">(</span><span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">image</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">'http://7fv9cr.com1.z0.glb.clouddn.com/marker.png'</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span></code></pre></figure>

<div class="map" id="map3"></div>

<h2 id="id-api">通过七牛 API</h2>

<p>鄙人既然使用七牛做图床，那么可以采用七牛图片处理的相关 API<a href="http://developer.qiniu.com/docs/v6/api/reference/fop/image/" title="图片 | 七牛云存储">[5]</a> 处理图片文件。</p>

<h3 id="id-section-1">图片水印</h3>

<p>使用七牛 API 的文字水印<a href="http://developer.qiniu.com/docs/v6/api/reference/fop/image/watermark.html#text-watermark" title="水印处理（watermark） | 七牛云存储">[6]</a>，可以存储单个标注的图片即可轻松变换出无数的图片，例如：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"http://api.map.baidu.com/api?v=2.0&amp;ak=您的密钥"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"map"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s1">'map'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mf">11.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">centerAndZoom</span><span class="p">(</span><span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="mf">116.4</span><span class="p">,</span> <span class="mf">23.4</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">letter</span><span class="p">;</span>
      <span class="nx">points</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">icons</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">markers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">letter</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">74</span><span class="p">;</span>
    <span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="s1">'116.'</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">()),</span> <span class="mf">23.4</span><span class="p">);</span>
    <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Icon</span><span class="p">(</span><span class="s1">'http://7fv9cr.com1.z0.glb.clouddn.com/marker.png?watermark/2/fill/d2hpdGU=/dx/8/dy/8/text/'</span> <span class="o">+</span> <span class="nx">btoa</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">letter</span><span class="p">)),</span> <span class="nx">size1</span><span class="p">,</span> <span class="p">{</span><span class="na">anchor</span><span class="p">:</span> <span class="nx">size2</span><span class="p">});</span>
    <span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="p">{</span><span class="na">icon</span><span class="p">:</span> <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]});</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addOverlay</span><span class="p">(</span><span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span></code></pre></figure>

<div class="map" id="map4"></div>

<h3 id="id-section-2">裁剪图片</h3>

<p>既然七牛也支持裁切图片<a href="http://developer.qiniu.com/docs/v6/api/reference/fop/image/imagemogr2.html#imagemogr2-crop-size-spec" title="高级处理（imageMogr2） | 七牛云存储">[7]</a>，那么也可以跟 CSS Image Sprites 般的处理，只不过是在图片本身做处理，而不是在展示图片时处理，如下：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"http://api.map.baidu.com/api?v=2.0&amp;ak=您的密钥"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"map"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s1">'map'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mf">11.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">centerAndZoom</span><span class="p">(</span><span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="mf">116.4</span><span class="p">,</span> <span class="mf">23.4</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">icons</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">markers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="s1">'116.'</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">()),</span> <span class="mf">23.4</span><span class="p">);</span>
    <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Icon</span><span class="p">(</span><span class="s1">'http://7fv9cr.com1.z0.glb.clouddn.com/markers.png?imageMogr2/crop/!23x25a0a'</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">size1</span><span class="p">,</span> <span class="p">{</span><span class="na">anchor</span><span class="p">:</span> <span class="nx">size2</span><span class="p">});</span>
    <span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="p">{</span><span class="na">icon</span><span class="p">:</span> <span class="nx">icons</span><span class="p">[</span><span class="nx">i</span><span class="p">]});</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addOverlay</span><span class="p">(</span><span class="nx">markers</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span></code></pre></figure>

<div class="map" id="map5"></div>

<h2 id="id-section-3">几种方式的对比</h2>

<p>一个地图里面需要显示 N 个有不同文字修饰的地标，那么：</p>

<table>
  <thead>
    <tr>
      <th>方式</th>
      <th>图片数</th>
      <th>IE8 支持</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>单张</td>
      <td>N</td>
      <td>是</td>
    </tr>
    <tr>
      <td>imageOffset</td>
      <td>1(大)</td>
      <td>是</td>
    </tr>
    <tr>
      <td>Canvas</td>
      <td>1(小)</td>
      <td>否</td>
    </tr>
    <tr>
      <td>七牛水印</td>
      <td>N</td>
      <td>否</td>
    </tr>
    <tr>
      <td>七牛裁剪</td>
      <td>N</td>
      <td>是</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>最省资源的恐怕是 HTML5 Canvas 的方式加载，只是对 IE8 的支持不是很好。</li>
  <li>较省事的是七牛 API 的处理，不过水印文字需要用到 Base64 编码，鄙人采用 <code class="highlighter-rouge">btoa()</code><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WindowBase64/Base64_encoding_and_decoding" title="Base64的编码与解码 - Web API 接口 | MDN">[8]</a> 对文字进行编码，并不兼容 IE8。</li>
  <li>想要兼容 IE8 并省资源，那还是得尽量采用百度地图自身的方法来实现，不过或许哪天，IE 的兼容也可以抛一边了。</li>
</ul>

<h2 id="id-section-4">覆盖物素材</h2>

<p>哦对了，若采用百度地图 API，我想采用他家的素材比较和谐，百度地图覆盖物的素材下面有一小部分。</p>

<blockquote>
  <p>http://api.map.baidu.com/img/markers.png</p>

  <p>http://api.map.baidu.com/images/dest_markers.png</p>

  <p>http://api.map.baidu.com/images/markers.png</p>

  <p>http://api.map.baidu.com/images/markers_new.png</p>

  <p>http://api.map.baidu.com/images/marker_red.png</p>

  <p>http://api.map.baidu.com/images/marker_red_sprite.png</p>

  <p>http://api.map.baidu.com/images/spotmkrs.png</p>

  <p>http://api.map.baidu.com/images/stop_icon.png</p>

  <p>http://api.map.baidu.com/images/trans_icons.png</p>

  <p>以上域名换成 <code class="highlighter-rouge">api0.map.bdimg.com</code> 亦可</p>

  <p>http://app.baidu.com/map/images/us_mk_icon.png</p>

  <p>http://webmap0.map.bdstatic.com/wolfman/static/common/images/markers_new2_31a3944.png</p>
</blockquote>

<h2 id="id-section-5">参考资料</h2>

<p><strong>本文历史</strong></p>

<ul>
  <li>2015 年 10 月 08 日 完成初稿</li>
</ul>



  </div>

  <div id="posts">
    <div id="random-posts" class="posts">
      <strong>猜你喜欢</strong>
      <ul>
      </ul>
    </div>
  
    <div id="recent-posts" class="posts">
      <strong>最近更新</strong>
      <ul>
      
        <li><a href="/configuring-ip-address-by-specifying-gateway" title="配置特定 IP 地址走指定网关">配置特定 IP 地址走指定网关 </a></li>
      
        <li><a href="/add-google-satellite-layer-in-amap" title="高德地图 API 叠加谷歌地图图层">高德地图 API 叠加谷歌地图图层 </a></li>
      
        <li><a href="/from-codoon-to-nikeplus" title="将咕咚的数据导入到 Nike+">将咕咚的数据导入到 Nike+ </a></li>
      
        <li><a href="/the-influence-of-sports-apps" title="运动 APP 的作用">运动 APP 的作用 </a></li>
      
        <li><a href="/the-last-run-of-june" title="今年 6 月的最后一次跑步">今年 6 月的最后一次跑步 </a></li>
      
      </ul>
    </div>
  </div>

  <div id="info" class="tech">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://127.0.0.1:4000/add-string-to-bmaps-api-markers" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=给地图标注加上字符 | 殷东亮的博客 via @&amp;url=http://127.0.0.1:4000/add-string-to-bmaps-api-markers&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://127.0.0.1:4000/add-string-to-bmaps-api-markers&amp;title=给地图标注加上字符 | 殷东亮的博客&amp;summary=在地图中，显示多个地点的时候，想要更好的区分，往往会使用不同样式的地点图标，或改变图标的形状，或改变图标的颜色，或在图标上加上字符。论其成本，恐怕在原有地点图标上加上字符是最低的，添加字符相对来说也更利于区分。&amp;site=http://127.0.0.1:4000"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1:4000/add-string-to-bmaps-api-markers&amp;text=给地图标注加上字符｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://127.0.0.1:4000/add-string-to-bmaps-api-markers&amp;t=给地图标注加上字符 | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://127.0.0.1:4000/add-string-to-bmaps-api-markers"><i class="icon-gplus-squared"></i></a>
</span>


    <span class='like'><a href="javascript:void(0)" title=""><i class="icon-heart-empty"></i> <span class="disqus-like-count"></span></a></span>
    <span class='view-code'><a href="javascript:void(0)" data-md="https://raw.githubusercontent.com/fooleap/fooleap.github.io/master/_posts/2015-10-08-add-string-to-bmaps-api-markers.md" title="在正文中查看源码"><i class="icon-file-code"></i>源码</a></span>
    <span class="number-of-word"><i class="icon-calc"></i>6391 字</span>
    <span class="page-tags"><i class="icon-tags"></i><ul class="tags"> <li class="tag"><a href="/tags.html#百度地图 API" target="_blank" title="查看“百度地图 API”的相关文章">百度地图 API</a></li><li class="tag"><a href="/tags.html#标注" target="_blank" title="查看“标注”的相关文章">标注</a></li><li class="tag"><a href="/tags.html#JavaScript" target="_blank" title="查看“JavaScript”的相关文章">JavaScript</a></li></ul></span>
  </div>

</article>

<div class="comment" id="disqus_thread">
    <a class="show-comments" href="http://127.0.0.1:4000/add-string-to-bmaps-api-markers#disqus_thread" data-disqus-identifier="/add-string-to-bmaps-api-markers"><span class="has-comment"><i class="icon-chat-empty"></i> 留下</span>评论 <span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:4000/add-string-to-bmaps-api-markers"></span></a>
</div>

  
  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=FCcc6261f101cd4ccefee22113a609de"></script>
  <script type="text/javascript">
  
  var bmaps = document.querySelectorAll('.map');
  for (var i = 0; i < bmaps.length; i++){
    bmaps[i].style.height = bmaps[1].offsetWidth * 2 / 3 + 'px';
  }
  var map1 = new BMap.Map('map1');
  map1.disableScrollWheelZoom() 
  map1.disableDoubleClickZoom() 
  map1.disableDragging();
  map1.centerAndZoom(new BMap.Point(116.4, 23.4), 10);
  var size1 = new BMap.Size(23, 25);
  var size2 = new BMap.Size(11.5, 25);
  var size3 = new BMap.Size(42, 25);
  var size4 = new BMap.Size(31.5, 25);
  var letter,
      points = [],
      icons = [],
      markers = [];
  var icons = [
    new BMap.Icon('http://source.fooleap.org/marker_a.png', size1, {anchor: size2 }),
    new BMap.Icon('http://source.fooleap.org/marker_b.png', size1, {anchor: size2 }),
    new BMap.Icon('http://source.fooleap.org/marker_c.png', size1, {anchor: size2 })
  ];
  for (var i = 0; i < 3; i++){
    points[i] = new BMap.Point(parseFloat('116.' + (i*3+1).toString()), 23.4);
    markers[i] = new BMap.Marker(points[i], {icon: icons[i]});
    map1.addOverlay(markers[i]);
  }

  var map2 = new BMap.Map('map2');
  map2.centerAndZoom(new BMap.Point(116.4, 23.4), 10);
  map2.disableScrollWheelZoom() 
  map2.disableDoubleClickZoom() 
  map2.disableDragging();
  for (var i = 0; i < 3; i++){
    points[i] = new BMap.Point(parseFloat('116.' + (i*3+1).toString()), 23.4);
    icons[i] = new BMap.Icon('http://source.fooleap.org/markers.png', size3, {anchor: size4, imageOffset: new BMap.Size(20, -(i+3)*25)});
    markers[i] = new BMap.Marker(points[i], {icon: icons[i]});
    map2.addOverlay(markers[i]);
  }

  var map3 = new BMap.Map('map3');
  var size31 = new BMap.Size(23, 25);
  var size32 = new BMap.Size(11.5, 25);
  map3.centerAndZoom(new BMap.Point(116.4, 23.4), 10);
  map3.disableScrollWheelZoom() 
  map3.disableDoubleClickZoom() 
  map3.disableDragging();
  var image = new Image();
  image.crossOrigin = '*';
  image.onload = function (){
    var width = this.width;
    var height = this.height;
    for(var i = 0; i < 3; i++) {
      letter = i + 71;
      var canvas = document.createElement('canvas');
          canvas.width = width;
          canvas.height = height;
      var ctx = canvas.getContext('2d');
          ctx.drawImage(this, 0, 0, width, height);
          ctx.textAlign = 'center';
          ctx.font = 'bold 10px sans-serif';
          ctx.fillStyle = '#ffffff';
          ctx.fillText(String.fromCharCode(letter), 9.5, height / 2);
      points[i] = new BMap.Point(parseFloat('116.' + (i*3+1).toString()), 23.4);
      icons[i] = new BMap.Icon(canvas.toDataURL(), size31, {anchor: size32});
      markers[i] = new BMap.Marker(points[i], {icon: icons[i]});
      map3.addOverlay(markers[i]);
    }
  }
  image.src = 'http://source.fooleap.org/marker.png';

  var map4 = new BMap.Map('map4');
  map4.centerAndZoom(new BMap.Point(116.4, 23.4), 10);
  map4.disableScrollWheelZoom() 
  map4.disableDoubleClickZoom() 
  map4.disableDragging();
  var letter;
      points = [],
      icons = [],
      markers = [];
  for (var i = 0; i < 3; i++){
    letter = i + 74;
    points[i] = new BMap.Point(parseFloat('116.' + (i*3+1).toString()), 23.4);
    icons[i] = new BMap.Icon('http://source.fooleap.org/marker.png?watermark/2/fill/d2hpdGU=/dx/8/dy/8/text/' + btoa(String.fromCharCode(letter)), size1, {anchor: size2});
    markers[i] = new BMap.Marker(points[i], {icon: icons[i]});
    map4.addOverlay(markers[i]);
  }

  var map5 = new BMap.Map('map5');
  map5.centerAndZoom(new BMap.Point(116.4, 23.4), 10);
  map5.disableScrollWheelZoom() 
  map5.disableDoubleClickZoom() 
  map5.disableDragging();
  var points = [],
      icons = [],
      markers = [];
  for (var i = 0; i < 3; i++){
    points[i] = new BMap.Point(parseFloat('116.' + (i*3+1).toString()), 23.4);
    icons[i] = new BMap.Icon('http://source.fooleap.org/markers.png?imageMogr2/crop/!23x25a0a' + i * 25, size1, {anchor: size2});
    markers[i] = new BMap.Marker(points[i], {icon: icons[i]});
    map5.addOverlay(markers[i]);
  }
  </script>
  </body>
</html>

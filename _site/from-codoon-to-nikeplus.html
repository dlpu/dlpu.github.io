<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>将咕咚的数据导入到 Nike+ | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="上篇文章说到运动 APP，Nike+ Running 是我目前正在使用的运动 APP，使用起来还算比较舒服，如果没特殊情况的话，我想不会更换成其他的。" />
    <meta name="keywords" content="Nike+, 咕咚, GPX" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://127.0.0.1:4000/from-codoon-to-nikeplus" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          将咕咚的数据导入到 Nike+
        </h1>
        <h2 class="sub-heading">
            <i class="icon-calendar"></i><time datetime="2016-07-31">2016 年 07 月 31 日</time>
        </h2>
      </header>
  <article class="post-content">
    
  <div class="main-content">
<p>上篇文章说到运动 APP，Nike+ Running 是我目前正在使用的运动 APP，使用起来还算比较舒服，如果没特殊情况的话，我想不会更换成其他的。</p>

<p>那么在使用 Nike+ 之前的时间里，我用的咕咚运动的数据，能不能转移到 Nike+ 上面呢？答案是肯定的，只是麻烦些。</p>

<p>咕咚后台并没有提供数据导出的功能，但咕咚网提供有 API<a href="http://open.codoon.com/" title="咕咚开放平台">[1]</a>，也就是说可以通过咕咚网 API，将自己的运动数据取下来。然而咕咚网提供的数据并不能直接导入 Nike+，也不能直接上传到任何可跟 Nike+ 同步的平台，例如 Garmin Connect<a href="https://connect.garmin.com/" title="Garmin Connect">[2]</a>。</p>

<p>GPX 是一种基于 XML，通用于存储 GPS 数据的文件格式，可以用它来记录地点、轨迹、路径等等。支持同步到 Nike+ 的 Garmin Connect 支持 GPX 文件的导入，另外，通过一个第三方平台 Nike+ Converter &amp; Uploader<a href="https://www.awsmithson.com/tcx2nikeplus/" title="Nike+ Converter &amp; Uploader">[3]</a>，可直接将 GPX 格式文件导入到 Nike+。</p>

<p>那也就是说，只要能把咕咚的数据转换成 GPX 格式即可，这个过程需要造一个轮子，Google 一下，很庆幸，已经有人造好了。<a href="http://www.wearable.pw/index.php/archives/332" title="将Codoon的路径记录导出成GPX路径">[4]</a><a href="https://github.com/iascchen/VisHealth/" title="iascchen / VisHealth">[5]</a></p>

<p>在近三年时间里，已经有些许变化，故应作修改。咕咚网的数据，iOS 版本跟 Android 版本并不完全相同。我的系统环境是 Windows 7 64 位版本，并已装 Python2。使用这个轮子，需要先使用 pip 安装几个依赖包。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pip install datetime gpxpy lxml requests
</code></pre>
</div>

<p>对代码进行简单修改，<code class="highlighter-rouge">codoonurl.py</code> 文件中：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#apiHost = "http://api.codoon.com/"</span>
<span class="n">apiHost</span> <span class="o">=</span> <span class="s">"https://openapi.codoon.com/"</span></code></pre></figure>

<p><code class="highlighter-rouge">codoon.py</code> 文件中：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#from time import strptime 此包不存在，用以下代替</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="o">...</span>
<span class="c">#tmptime = strptime( p["time_stamp"] , DATE_FORMAT ) 有两行，可用以下对应版本替换，因咕咚网的数据 iOS 版本时间还带三个小数位。另外，因时区问题先自减 8 个小时。</span>
<span class="c">#Android</span>
<span class="n">tmptime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span> <span class="n">p</span><span class="p">[</span><span class="s">"time_stamp"</span><span class="p">]</span> <span class="p">,</span> <span class="n">DATE_FORMAT</span> <span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="c">#iOS</span>
<span class="n">tmptime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span> <span class="n">p</span><span class="p">[</span><span class="s">"time_stamp"</span><span class="p">][:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="p">,</span> <span class="n">DATE_FORMAT</span> <span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="c">#return gpx.to_xml() 默认的 1.0 版本无法导入 Nike+</span>
<span class="k">return</span> <span class="n">gpx</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s">"1.1"</span><span class="p">)</span></code></pre></figure>

<p>因为鄙人没有佳明表，也就不想通过访问速度并不快的 Garmin Connect 来同步，所以以上的修改都是针对导入 Nike+ 的。</p>

<p>怎么使用呢？只需在 <code class="highlighter-rouge">codoon.py</code> 里面填入咕咚的用户名及密码，将最后面的 routeId 替换成相应单次运动的 <code class="highlighter-rouge">route_id</code> ，运动即可获取该次运动的咕咚网数据及两个 GPX 文件，一个 route，一个 track，Nike+ Converter &amp; Uploader 只支持 track。</p>

<p>那么问题来了，如何获取单次运动的 <code class="highlighter-rouge">route_id</code> 呢？可以打开咕咚网，点到该次运动，傻傻的打开 Developer Tools，在 NetWork 选项卡中刷新，你会发现的。</p>

<p>这明显比搬砖还要难受，太麻烦了。而这个工具已经有提供相应的功能，通过咕咚的 API 获取相应的数据。仅需取消 <code class="highlighter-rouge">codoon.py</code> 以下两行的注释，即可获取咕咚的运动数据列表，即每次运动数据的各种属性。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">routes</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">get_route_log</span><span class="p">(</span> <span class="n">productId</span> <span class="o">=</span> <span class="n">imei</span> <span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">saveJsonData</span><span class="p">(</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">"/route_log.json"</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">routes</span><span class="p">)</span></code></pre></figure>

<p>默认只能获取最新的一百次运动的数据。可修改上面定义函数的 <code class="highlighter-rouge">count</code>：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_route_log</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span> <span class="n">productId</span> <span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">100</span> <span class="p">,</span> <span class="n">excluded</span> <span class="o">=</span> <span class="s">""</span> <span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">isPart</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">codoonurl</span><span class="o">.</span><span class="n">getRouteLogUrl</span><span class="p">()</span>
    <span class="n">request_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"product_id"</span> <span class="p">:</span> <span class="n">productId</span> <span class="p">,</span> <span class="s">"count"</span> <span class="p">:</span> <span class="n">count</span> <span class="p">,</span> <span class="s">"excluded"</span> <span class="p">:</span> <span class="n">excluded</span> <span class="p">,</span><span class="s">"page"</span> <span class="p">:</span> <span class="n">page</span> <span class="p">,</span> <span class="s">"is_part"</span> <span class="p">:</span> <span class="n">isPart</span> <span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">excutePostRequst</span><span class="p">(</span><span class="n">command</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">request_data</span><span class="p">)</span></code></pre></figure>

<p>获取下来的数据中 <code class="highlighter-rouge">"sports_type" = 1</code> 的即表示跑步运动类型，再相应复制其 <code class="highlighter-rouge">route_id</code> 去获取数据即可。</p>

<p>是不是还是很麻烦？鄙人想也是，应该修改为全自动获取所有跑步运动的单次数据，并保存为各自的文件，即使是这样，也还得每个文件手动去导入到 Nike+。想要实现自动同步，看起来还挺有事做的。鄙人并不懂 Python，就不再继续折腾。</p>

<p>使用的过程中，我发现 iOS 记录的数据，转成 GPX 格式后，导入 Nike+ 竟然不显示其路径，但是能显示距离。查看其文件跟 Android 并无明显区别，唯一有区别的似乎只有海拨数据，iOS 记录的是整数，整体添加一个小数点上传依然不行，搞不明白索性就算。</p>

<h2 id="id-section">参考资料</h2>

<p><strong>本文历史</strong></p>

<ul>
  <li>2016 年 07 月 31 日 完成初稿</li>
</ul>

  </div>

  <div id="posts">
    <div id="random-posts" class="posts">
      <strong>猜你喜欢</strong>
      <ul>
      </ul>
    </div>
  
    <div id="recent-posts" class="posts">
      <strong>最近更新</strong>
      <ul>
      
        <li><a href="/configuring-ip-address-by-specifying-gateway" title="配置特定 IP 地址走指定网关">配置特定 IP 地址走指定网关 </a></li>
      
        <li><a href="/add-google-satellite-layer-in-amap" title="高德地图 API 叠加谷歌地图图层">高德地图 API 叠加谷歌地图图层 </a></li>
      
        <li><a href="/from-codoon-to-nikeplus" title="将咕咚的数据导入到 Nike+">将咕咚的数据导入到 Nike+ </a></li>
      
        <li><a href="/the-influence-of-sports-apps" title="运动 APP 的作用">运动 APP 的作用 </a></li>
      
        <li><a href="/the-last-run-of-june" title="今年 6 月的最后一次跑步">今年 6 月的最后一次跑步 </a></li>
      
      </ul>
    </div>
  </div>

  <div id="info" class="tech">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://127.0.0.1:4000/from-codoon-to-nikeplus" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=将咕咚的数据导入到 Nike+ | 殷东亮的博客 via @&amp;url=http://127.0.0.1:4000/from-codoon-to-nikeplus&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://127.0.0.1:4000/from-codoon-to-nikeplus&amp;title=将咕咚的数据导入到 Nike+ | 殷东亮的博客&amp;summary=上篇文章说到运动 APP，Nike+ Running 是我目前正在使用的运动 APP，使用起来还算比较舒服，如果没特殊情况的话，我想不会更换成其他的。&amp;site=http://127.0.0.1:4000"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1:4000/from-codoon-to-nikeplus&amp;text=将咕咚的数据导入到 Nike+｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://127.0.0.1:4000/from-codoon-to-nikeplus&amp;t=将咕咚的数据导入到 Nike+ | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://127.0.0.1:4000/from-codoon-to-nikeplus"><i class="icon-gplus-squared"></i></a>
</span>


    <span class='like'><a href="javascript:void(0)" title=""><i class="icon-heart-empty"></i> <span class="disqus-like-count"></span></a></span>
    <span class='view-code'><a href="javascript:void(0)" data-md="https://raw.githubusercontent.com/fooleap/fooleap.github.io/master/_posts/2016-07-31-from-codoon-to-nikeplus.md" title="在正文中查看源码"><i class="icon-file-code"></i>源码</a></span>
    <span class="number-of-word"><i class="icon-calc"></i>2423 字</span>
    <span class="page-tags"><i class="icon-tags"></i><ul class="tags"> <li class="tag"><a href="/tags.html#Nike+" target="_blank" title="查看“Nike+”的相关文章">Nike+</a></li><li class="tag"><a href="/tags.html#咕咚" target="_blank" title="查看“咕咚”的相关文章">咕咚</a></li><li class="tag"><a href="/tags.html#GPX" target="_blank" title="查看“GPX”的相关文章">GPX</a></li></ul></span>
  </div>

</article>

<div class="comment" id="disqus_thread">
    <a class="show-comments" href="http://127.0.0.1:4000/from-codoon-to-nikeplus#disqus_thread" data-disqus-identifier="/from-codoon-to-nikeplus"><span class="has-comment"><i class="icon-chat-empty"></i> 留下</span>评论 <span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:4000/from-codoon-to-nikeplus"></span></a>
</div>

  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  </body>
</html>

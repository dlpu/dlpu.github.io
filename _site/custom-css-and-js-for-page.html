<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>页面样式脚本各得其所 | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="在写日志的时候，鄙人有时候需要引入及写自定义的 CSS 或 JS，一般是在日志里面直接引入标签直接写。" />
    <meta name="keywords" content="Jekyll, Liquid, CSS, JavaScript" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://127.0.0.1:4000/custom-css-and-js-for-page" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          页面样式脚本各得其所
        </h1>
        <h2 class="sub-heading">
            <i class="icon-calendar"></i><time datetime="2015-08-23">2015 年 08 月 23 日</time>
        </h2>
      </header>
  <article class="post-content">
    
  <div class="main-content">
<ul id="toc">
  <li><a href="#id-section" id="markdown-toc-id-section">问题描述</a></li>
  <li><a href="#id-section-1" id="markdown-toc-id-section-1">解决过程</a></li>
  <li><a href="#id-section-2" id="markdown-toc-id-section-2">完整方案</a></li>
  <li><a href="#id-section-3" id="markdown-toc-id-section-3">参考资料</a></li>
</ul>

<h2 id="id-section">问题描述</h2>

<p>在写日志的时候，鄙人有时候需要引入及写自定义的 CSS 或 JS，一般是在日志里面直接引入标签直接写。</p>

<p>众所周知，<code class="highlighter-rouge">&lt;style&gt;</code> 标签位于 <code class="highlighter-rouge">&lt;head&gt;</code> 内，虽然写在 <code class="highlighter-rouge">&lt;body&gt;</code> 浏览器也能渲染成功，但这毕竟有悖于标准；而 <code class="highlighter-rouge">&lt;script&gt;</code> 标签一般都会放在 <code class="highlighter-rouge">&lt;body&gt;</code> 标签的最后（即 <code class="highlighter-rouge">&lt;/body&gt;</code> 之前），以免网速影响体验。</p>

<p>不按上面所提到的写，虽然偶尔一两个页面这样没大碍，但对于鄙人这种强迫症患者忍不了，所以只好想办法解决。</p>

<h2 id="id-section-1">解决过程</h2>

<p>想要改变 Jekyll 生成的 HTML，还得从 Jekyll 的模板入手，而 Jekyll 采用的是 Liquid 模板语言。</p>

<p>Liquid 是由 Shopify 设计并开源的模板引擎，Liquid 的相关语法不难，具体可以看这个页面：<a href="https://github.com/Shopify/liquid/wiki/Liquid-for-Designers">Liquid for Designer</a>，更详细的介绍在：<a href="https://docs.shopify.com/themes/liquid-documentation/">Liquid Documentation</a>，Jekyll 自身也有一些的扩展语法，可以查看：<a href="http://jekyllrb.com/docs/templates/">Templates</a>。</p>

<p>这次要做的是将页面的自定义 CSS 以及 JS 移个位置，而 CSS 及 JS 对应的是 <code class="highlighter-rouge">&lt;style&gt;</code> 标签以及 <code class="highlighter-rouge">&lt;script&gt;</code> 标签，可以采用过滤器 <code class="highlighter-rouge">split</code> 分隔开内容。</p>

<p>这里先拿 CSS 部分做例子，考虑到标签闭合前面有个 <code class="highlighter-rouge">/</code> 符号，可以这么处理：</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid"><span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">content_style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s1">'style&gt;'</span><span class="w"> </span><span class="p">%}</span></code></pre></figure>

<p>那么 <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">content_style[0]</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> 便是 <code class="highlighter-rouge">&lt;style&gt;</code> 之前的部分，后面多加了个 <code class="highlighter-rouge">&lt;</code>；<code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">content_style[1]</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> 是 CSS 代码后面多加了 <code class="highlighter-rouge">&lt;/</code>；<code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">content_style[2]</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> 则是 CSS 代码之后的部分。</p>

<p>这样需要过滤掉不需要的字符，又不能保证原文中有且只有一个 <code class="highlighter-rouge">&lt;</code> 符号，没有找到相关的更方便方法，所以鄙人采用笨方法，在原文中：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!--&lt;style&gt;
CSS 代码
&lt;/style&gt;--&gt;</span></code></pre></figure>

<p>原模板 <code class="highlighter-rouge">default.html</code> 中的 <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">content</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> 就可替换成</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid"><span class="p">{{</span><span class="w"> </span><span class="nv">content_style</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">remove</span><span class="p">:</span><span class="w"> </span><span class="s1">'&lt;!--&lt;'</span><span class="w"> </span><span class="p">}}{{</span><span class="w"> </span><span class="nv">content_style</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">remove</span><span class="p">:</span><span class="w"> </span><span class="s1">'--&gt;'</span><span class="w"> </span><span class="p">}}</span></code></pre></figure>

<p>其实不做 <code class="highlighter-rouge">remove</code> 处理页面上也不会出现多余的内容，只是源码多出了<code class="highlighter-rouge">&lt;!--&lt;--&gt;</code>。若含有 CSS 代码的日志才这么干，没有的不干，这里采用 Jekyll 提供的自定义页面变量，在 Front Matter 加上 <code class="highlighter-rouge">style: true</code>，使用 Liquid 的判断语句。</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid"><span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">style</span><span class="w"> </span><span class="p">%}</span>
...
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span></code></pre></figure>

<p>JS 脚本类似于 CSS，另外，引入 CSS 或 JS 文件则可以直接将其命名为自定义变量引入。</p>

<h2 id="id-section-2">完整方案</h2>

<p>经过折腾之后，在模板 <code class="highlighter-rouge">default.html</code> 文件中，鄙人做如下处理。</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
...
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">content_js</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">remove</span><span class="p">:</span><span class="w"> </span><span class="s1">'&lt;!--&lt;'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">remove</span><span class="p">:</span><span class="w"> </span><span class="s1">'--&gt;'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s1">'script&gt;'</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">content_style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">remove</span><span class="p">:</span><span class="w"> </span><span class="s1">'&lt;!--&lt;'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">remove</span><span class="p">:</span><span class="w"> </span><span class="s1">'--&gt;'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s1">'style&gt;'</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">link</span><span class="w"> </span><span class="p">%}</span>
  &lt;link rel="stylesheet" type="text/css" href="<span class="p">{{</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">link</span><span class="w"> </span><span class="p">}}</span>" /&gt;
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">style</span><span class="w"> </span><span class="p">%}</span>
  &lt;style type="text/css"&gt;<span class="p">{{</span><span class="w"> </span><span class="nv">content_style</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span>style&gt;
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
...
&lt;/head&gt;
&lt;body&gt;
...
<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">style</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">js</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">style</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">js</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{{</span><span class="w"> </span><span class="nv">content_style</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">}}{{</span><span class="w"> </span><span class="nv">content_style</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">js</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">style</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{{</span><span class="w"> </span><span class="nv">content_js</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">}}{{</span><span class="w"> </span><span class="nv">content_js</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">style</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">js</span><span class="w">  </span><span class="p">%}</span>
    <span class="p">{{</span><span class="w"> </span><span class="nv">content_style</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">}}{{</span><span class="w"> </span><span class="nv">content_js</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
...
  &lt;script type="text/javascript" src="/assets/js/jquery.min.js"&gt;&lt;/script&gt;
  <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c">鉴于引入的 JS 文件或脚本可能依赖于 jQuery，故放此。</span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span> 
<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">scripts</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span>script<span class="w"> </span>in<span class="w"> </span>page.scripts<span class="w"> </span><span class="p">%}</span>
    &lt;script type="text/javascript" src="<span class="p">{{</span><span class="w"> </span><span class="nv">script</span><span class="w"> </span><span class="p">}}</span>"&gt;&lt;/script&gt;
  <span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">js</span><span class="w"> </span><span class="p">%}</span>
  &lt;script type="text/javascript"&gt;<span class="p">{{</span><span class="w"> </span><span class="nv">content_js</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span>script&gt;
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
...
&lt;/body&gt;
&lt;/html&gt;</code></pre></figure>

<p>代码比较简单比较丑，但可以用，这里需要说明的是，鄙人往往将 <code class="highlighter-rouge">&lt;style&gt;</code>、<code class="highlighter-rouge">&lt;script&gt;</code> 按顺序排在一起。例子的话，可以查看鄙人任何一篇含有自定义代码的日志，点击左下角“源码”按钮便可看到相关 <code class="highlighter-rouge">*md</code> 文件内容，例如：<a href="/talk-about-my-lost-cell-phone.html">我那丢了的手机 </a>。</p>

<h2 id="id-section-3">参考资料</h2>

<ul>
  <li><a href="https://github.com/Shopify/liquid/wiki/Liquid-for-Designers">Liquid for Designer</a></li>
  <li><a href="https://docs.shopify.com/themes/liquid-documentation/">Liquid Documentation</a></li>
</ul>

<p><strong>本文历史</strong></p>

<ul>
  <li>2015 年 08 月 23 日 完成初稿</li>
</ul>

  </div>

  <div id="posts">
    <div id="random-posts" class="posts">
      <strong>猜你喜欢</strong>
      <ul>
      </ul>
    </div>
  
    <div id="recent-posts" class="posts">
      <strong>最近更新</strong>
      <ul>
      
        <li><a href="/configuring-ip-address-by-specifying-gateway" title="配置特定 IP 地址走指定网关">配置特定 IP 地址走指定网关 </a></li>
      
        <li><a href="/add-google-satellite-layer-in-amap" title="高德地图 API 叠加谷歌地图图层">高德地图 API 叠加谷歌地图图层 </a></li>
      
        <li><a href="/from-codoon-to-nikeplus" title="将咕咚的数据导入到 Nike+">将咕咚的数据导入到 Nike+ </a></li>
      
        <li><a href="/the-influence-of-sports-apps" title="运动 APP 的作用">运动 APP 的作用 </a></li>
      
        <li><a href="/the-last-run-of-june" title="今年 6 月的最后一次跑步">今年 6 月的最后一次跑步 </a></li>
      
      </ul>
    </div>
  </div>

  <div id="info" class="tech">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://127.0.0.1:4000/custom-css-and-js-for-page" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=页面样式脚本各得其所 | 殷东亮的博客 via @&amp;url=http://127.0.0.1:4000/custom-css-and-js-for-page&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://127.0.0.1:4000/custom-css-and-js-for-page&amp;title=页面样式脚本各得其所 | 殷东亮的博客&amp;summary=在写日志的时候，鄙人有时候需要引入及写自定义的 CSS 或 JS，一般是在日志里面直接引入标签直接写。&amp;site=http://127.0.0.1:4000"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1:4000/custom-css-and-js-for-page&amp;text=页面样式脚本各得其所｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://127.0.0.1:4000/custom-css-and-js-for-page&amp;t=页面样式脚本各得其所 | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://127.0.0.1:4000/custom-css-and-js-for-page"><i class="icon-gplus-squared"></i></a>
</span>


    <span class='like'><a href="javascript:void(0)" title=""><i class="icon-heart-empty"></i> <span class="disqus-like-count"></span></a></span>
    <span class='view-code'><a href="javascript:void(0)" data-md="https://raw.githubusercontent.com/fooleap/fooleap.github.io/master/_posts/2015-08-23-custom-css-and-js-for-page.md" title="在正文中查看源码"><i class="icon-file-code"></i>源码</a></span>
    <span class="number-of-word"><i class="icon-calc"></i>2792 字</span>
    <span class="page-tags"><i class="icon-tags"></i><ul class="tags"> <li class="tag"><a href="/tags.html#Jekyll" target="_blank" title="查看“Jekyll”的相关文章">Jekyll</a></li><li class="tag"><a href="/tags.html#Liquid" target="_blank" title="查看“Liquid”的相关文章">Liquid</a></li><li class="tag"><a href="/tags.html#CSS" target="_blank" title="查看“CSS”的相关文章">CSS</a></li><li class="tag"><a href="/tags.html#JavaScript" target="_blank" title="查看“JavaScript”的相关文章">JavaScript</a></li></ul></span>
  </div>

</article>

<div class="comment" id="disqus_thread">
    <a class="show-comments" href="http://127.0.0.1:4000/custom-css-and-js-for-page#disqus_thread" data-disqus-identifier="/custom-css-and-js-for-page"><span class="has-comment"><i class="icon-chat-empty"></i> 留下</span>评论 <span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:4000/custom-css-and-js-for-page"></span></a>
</div>

  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  </body>
</html>

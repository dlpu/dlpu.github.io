<!DOCTYPE html>
<!--[if lte IE 8]><html class="ie lte8"><![endif]-->
<!--[if IE]><html class="ie"><![endif]-->
<!--[if !IE]><!--><html><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>JavaScript 实现 Vim 键绑定 | 殷东亮的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.3, user-scalable=no" />
    <meta name="description" content="一旦习惯 Vim 的热键操作，网页浏览也会想用熟悉的热键操作，有人为热门浏览器开发了扩展，例如 Firefox 有个人觉得近完美的扩展解决方案 Vimperator 或 Pentadactyl，Chrome 则有不大完美的 Vichrome、Vimium 等，还有些人直接写了类 vi 的浏览器，例如 dwb，不过我想没用过 vi 的人不会去尝试这样的扩展或软件。" />
    <meta name="keywords" content="JavaScript, Vim, Key Bindings, 快捷键" />
    <meta name="author" content="fooleap" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="canonical" href="http://127.0.0.1:4000/vim-key-bindings-for-web-page" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    <link rel="icon" href="/favicon.png" />
    <link rel="alternate" type="application/atom+xml" title="殷东亮的博客 Atom Feed" href="http://blog.fooleap.org/atom.xml" />
    <script type="text/javascript" src="/assets/js/modernizr.js"></script>
    <!--[if lte IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
      <script src="/assets/js/classList.min.js"></script>
      <script type="text/javascript">
        document.createElement('main');
      </script>
    <![endif]-->
  </head>
  <body>
  <nav id="navigation">
      <ul class="navigation-list hide">
          <li><a href="/" class="navigation-item"><i class="icon-home"></i>首页</a></li>
          <li><a href="/archive.html" class="navigation-item"><i class="icon-box"></i>归档</a></li>
          <li><a href="/about.html" class="navigation-item"><i class="icon-user"></i>关于</a></li>
      </ul>
      <i id="menu" class="icon icon-menu"></i>
  </nav>
  
  <div class="container">
    <main class="wrapper">
      <header class="site-header">
        <h1>
          JavaScript 实现 Vim 键绑定
        </h1>
        <h2 class="sub-heading">
            <i class="icon-calendar"></i><time datetime="2015-09-20">2015 年 09 月 20 日</time>
        </h2>
      </header>
  <article class="post-content">
    
  <div class="main-content">
<ul id="toc">
  <li><a href="#id-vim-" id="markdown-toc-id-vim-">Vim 热键</a></li>
  <li><a href="#id-section" id="markdown-toc-id-section">功能介绍</a></li>
  <li><a href="#id-section-1" id="markdown-toc-id-section-1">键盘事件</a></li>
  <li><a href="#id-section-2" id="markdown-toc-id-section-2">实现过程</a>    <ul>
      <li><a href="#id-section-3" id="markdown-toc-id-section-3">上下滚一行</a></li>
      <li><a href="#id-n-" id="markdown-toc-id-n-">上下滚 n 行</a></li>
      <li><a href="#id-section-4" id="markdown-toc-id-section-4">回到顶部</a></li>
      <li><a href="#id-section-5" id="markdown-toc-id-section-5">滚到底部</a></li>
    </ul>
  </li>
  <li><a href="#id-section-6" id="markdown-toc-id-section-6">完整代码</a></li>
  <li><a href="#id-section-7" id="markdown-toc-id-section-7">参考资料</a></li>
</ul>

<h2 id="id-vim-">Vim 热键</h2>

<p>一旦习惯 Vim 的热键操作，网页浏览也会想用熟悉的热键操作，有人为热门浏览器开发了扩展，例如 Firefox 有个人觉得近完美的扩展解决方案 Vimperator 或 Pentadactyl，Chrome 则有不大完美的 Vichrome、Vimium 等<a href="http://vim.wikia.com/wiki/Vim_key_bindings_for_web_browsers" title="Vim key bindings for web browsers">[1]</a>，还有些人直接写了类 vi 的浏览器，例如 dwb<a href="http://portix.bitbucket.org/dwb/" title="dwb - a webkit browser">[2]</a>，不过我想没用过 vi 的人不会去尝试这样的扩展或软件。</p>

<p><img src="http://source.fooleap.org/vim-key-bindings-for-web-page-01.png?imageView2/2/w/640" alt="dwb 界面" />
▲dwb 界面</p>

<p>那么，能不能直接使用 JavaScript，在网站中实现热键操作，让访问你网站的人都能享受，答案是可以的，知乎的快捷键就有些 vi 的感觉<a href="http://www.zhihu.com/question/19842222" title="知乎支持快捷键吗？">[3]</a>。</p>

<p><img src="http://source.fooleap.org/vim-key-bindings-for-web-page-02.png" alt="知乎的快捷键" />
▲知乎的快捷键</p>

<h2 id="id-section">功能介绍</h2>

<p>小博在右下角弄个回到顶部按钮，对长文而言，使用鼠标慢慢滚，拉到下面，一点就回到顶部，感觉方便的，但有时候还是感觉有些多余。键盘也可用空格或 <code class="highlighter-rouge">Home</code> <code class="highlighter-rouge">End</code> 等键，但我想说离得太远了，如若和鄙人一样使用 <a href="poker-2.html">Poker II</a> 等迷你键盘更是麻烦，何不采用 Vim 的热键来操作呢？使用 <code class="highlighter-rouge">g</code> <code class="highlighter-rouge">g</code> 来返回顶部不是更方便么？所以，鄙人就想使用 JavaScript 实现这么几个简单的键绑定：</p>

<table>
  <thead>
    <tr>
      <th>热键</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">j</code></td>
      <td>下滚一行</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">k</code></td>
      <td>上滚一行</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">2</code> <code class="highlighter-rouge">j</code></td>
      <td>下滚 2 行</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">3</code> <code class="highlighter-rouge">k</code></td>
      <td>上滚 3 行</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">g</code> <code class="highlighter-rouge">g</code></td>
      <td>回到顶部</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">G</code> (<code class="highlighter-rouge">Shift</code> + <code class="highlighter-rouge">g</code>)</td>
      <td>滚到底部</td>
    </tr>
  </tbody>
</table>

<p>注：<code class="highlighter-rouge">2</code> <code class="highlighter-rouge">j</code> 中数字可以为任意正整数。</p>

<h2 id="id-section-1">键盘事件</h2>

<p>键盘操作自然离不开监听键盘事件，键盘事件有三个，分别是</p>

<table>
  <thead>
    <tr>
      <th>事件</th>
      <th>说明</th>
      <th>属性</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>keydown</td>
      <td>按下按键</td>
      <td>keyCode</td>
    </tr>
    <tr>
      <td>keypress</td>
      <td>字符键按下</td>
      <td>charCode</td>
    </tr>
    <tr>
      <td>keyup</td>
      <td>释放按键</td>
      <td>keyCode</td>
    </tr>
  </tbody>
</table>

<p>注：其中 <code class="highlighter-rouge">keypress</code> 事件是按下可输入字符的键就会触发，例如 <code class="highlighter-rouge">a</code>、<code class="highlighter-rouge">b</code>、<code class="highlighter-rouge">c</code>，若按下 <code class="highlighter-rouge">Ctrl</code>、<code class="highlighter-rouge">Shift</code> 等则不触发。</p>

<p>触发事件会返回对象，其中 <code class="highlighter-rouge">keydown</code>、<code class="highlighter-rouge">keyup</code> 事件会返回 <code class="highlighter-rouge">keyCode</code> 属性，有些浏览器比如 Firefox 还会返回 <code class="highlighter-rouge">key</code> 属性，但一般还是使用兼容性比较好的 <code class="highlighter-rouge">keyCode</code>；<code class="highlighter-rouge">keypress</code> 事件则会返回 <code class="highlighter-rouge">charCode</code> 属性。</p>

<p>其中 <code class="highlighter-rouge">keyCode</code> 的值可以在 MDN 找到<a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode" title="KeyboardEvent.keyCode - Web API Interfaces | MDN">[4]</a>，<code class="highlighter-rouge">charCode</code> 则区分大小写，属性值基本等同于 ASCII 码<a href="https://zh.wikipedia.org/wiki/ASCII" title="ASCII - 维基百科">[5]</a>。</p>

<p>JavaScript Event KeyCodes<a href="http://keycode.info/" title="JavaScript Event KeyCodes">[6]</a>这个网站可以方便获取 <code class="highlighter-rouge">keyCode</code> 值，另外可以使用代码自己获取 <code class="highlighter-rouge">keyCode</code>：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keydown'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">});</span></code></pre></figure>

<p><code class="highlighter-rouge">charCode</code> 值则可用下面代码获得：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keypress'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">});</span></code></pre></figure>

<p>说了这么多，上面所说需要用到的几个键，其 <code class="highlighter-rouge">keyCode</code> 及 <code class="highlighter-rouge">charCode</code> 如下：</p>

<table>
  <thead>
    <tr>
      <th>按键</th>
      <th>keyCode</th>
      <th>charCode</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">Shift</code></td>
      <td>16</td>
      <td>无</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">0 - 9</code></td>
      <td>48 - 57</td>
      <td>48 - 57</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">G</code></td>
      <td>71</td>
      <td>71</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">g</code></td>
      <td>71</td>
      <td>103</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">j</code></td>
      <td>74</td>
      <td>106</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">k</code></td>
      <td>75</td>
      <td>107</td>
    </tr>
  </tbody>
</table>

<p>注：均为数字，非字符。</p>

<h2 id="id-section-2">实现过程</h2>

<h3 id="id-section-3">上下滚一行</h3>

<p>看几个快捷键操作，<code class="highlighter-rouge">j</code>、<code class="highlighter-rouge">k</code> 想必是最简单的，其余几个可能没有那么简单，所以先从简单的出发。</p>

<p>监听 <code class="highlighter-rouge">keydown</code> 事件，如果按下 <code class="highlighter-rouge">j</code>, <code class="highlighter-rouge">k</code> 键，使用 <code class="highlighter-rouge">scrollBy()</code> 方法实现上滚下滚一行<a href="http://www.w3school.com.cn/jsref/met_win_scrollby.asp" title="HTML DOM scrollBy() 方法">[7]</a>，假定行高为 20 个像素，那么：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">keysDown</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">74</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">75</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keydown'</span><span class="p">,</span> <span class="nx">keysDown</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></code></pre></figure>

<h3 id="id-n-">上下滚 n 行</h3>

<p>数字的 <code class="highlighter-rouge">keyCode</code> 并不等于原数字，所以这里引入一个数组，当输入为数字时，将数组内对应值赋值为原数字。每次输入数字的时候，还要结合此前输入的数字进行计算，结合上面的上下滚一行，实现如下：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">lineHeight</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="c1">// 行高，可设置
</span>
<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">keysDown</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">74</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">lineHeight</span> <span class="o">*</span> <span class="nx">row</span> <span class="p">);</span>
      <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">lineHeight</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">75</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">lineHeight</span> <span class="o">*</span> <span class="nx">row</span> <span class="p">);</span>
      <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">lineHeight</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&gt;=</span> <span class="mi">48</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&lt;=</span> <span class="mi">57</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">48</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">57</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">-</span> <span class="mi">48</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">row</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">].</span><span class="nx">toString</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keydown'</span><span class="p">,</span> <span class="nx">keysDown</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></code></pre></figure>

<h3 id="id-section-4">回到顶部</h3>

<p>Vim 的普通模式下按下 <code class="highlighter-rouge">g</code> <code class="highlighter-rouge">g</code>，即双击 <code class="highlighter-rouge">g</code>，就回到顶部，双击一般有一个延时的处理，虽然看起来挺简单，但凭空想象还是需要时间的，二话不说先 Google 一番，很快便在 Stack Overflow 找到了解决方法<a href="http://stackoverflow.com/a/4478456" title="vim - press two continuous key to trigger an event in JavaScript - Stack Overflow">[8]</a>，不得不说这方法有些小聪明。</p>

<p>返回顶部用到了 <code class="highlighter-rouge">scrollTo()</code> 方法<a href="http://www.w3school.com.cn/jsref/met_win_scrollto.asp" title="HTML DOM scrollTo() 方法">[9]</a>，具体代码可以这样写：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">inCombo</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">keysDown</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">71</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">inCombo</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inCombo</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="c1">// 五百毫秒的延时，即需在半秒内完成双击
</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">'inCombo = false;'</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keydown'</span><span class="p">,</span> <span class="nx">keysDown</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></code></pre></figure>

<h3 id="id-section-5">滚到底部</h3>

<p>滚到底部是 <code class="highlighter-rouge">Shift</code> + <code class="highlighter-rouge">g</code>，也即是组合键操作，不得不说 Google 才是人类的未来，一搜便可<a href="http://www.kirupa.com/html5/keyboard_events_in_javascript.htm" title="Keyboard Events in JavaScript">[10]</a>。</p>

<p>这里滚到底部需要获取整个网页的高度，其实这是个大坑，<code class="highlighter-rouge">offsetHeight</code>、<code class="highlighter-rouge">scrollHeight</code> 傻傻分不清，各浏览器的标准也有区别，这里就随便丢了算是整个网页高度的 <code class="highlighter-rouge">document.body.scrollHeight</code>，其实真的很想简单粗暴丢个 <code class="highlighter-rouge">99999</code>：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">function</span> <span class="nx">keysDown</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">keys</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">keys</span><span class="p">[</span><span class="mi">71</span><span class="p">])</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">keysUp</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">keys</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keydown'</span><span class="p">,</span> <span class="nx">keysDown</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keyup'</span><span class="p">,</span> <span class="nx">keysUp</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></code></pre></figure>

<h2 id="id-section-6">完整代码</h2>

<p>整合以上功能，且为一些浏览器做兼容之后<a href="http://stackoverflow.com/a/9507321" title="javascript - Why keydown listener doesn&#39;t work in IE - Stack Overflow">[11]</a>，完整代码如下：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">inCombo</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">lineHeight</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">keysDown</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">keys</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">keys</span><span class="p">[</span><span class="mi">71</span><span class="p">])</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollHeight</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="mi">71</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">inCombo</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inCombo</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">'inCombo = false;'</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="mi">74</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">lineHeight</span> <span class="o">*</span> <span class="nx">row</span> <span class="p">);</span>
      <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">lineHeight</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="mi">75</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">lineHeight</span> <span class="o">*</span> <span class="nx">row</span> <span class="p">);</span>
      <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">lineHeight</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&gt;=</span> <span class="mi">48</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&lt;=</span> <span class="mi">57</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">48</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">57</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">-</span> <span class="mi">48</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">row</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">].</span><span class="nx">toString</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">keysUp</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">keys</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">){</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keydown'</span><span class="p">,</span> <span class="nx">keysDown</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"keyup"</span><span class="p">,</span> <span class="nx">keysUp</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">){</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">'onkeydown'</span><span class="p">,</span> <span class="nx">keysDown</span><span class="p">);</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">'onkeyup'</span><span class="p">,</span> <span class="nx">keysUp</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'keydown'</span><span class="p">,</span> <span class="nx">keysDown</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"keyup"</span><span class="p">,</span> <span class="nx">keysUp</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>上面说了那么多，原来也不需要用到 <code class="highlighter-rouge">keypress</code>，如果做到严格一点，区分大小写，或许 <code class="highlighter-rouge">keypress</code> 就派上用场。不过我想现在大多数人的大写锁定键基本不用到，所以也没必要较劲。为啥不实现 <code class="highlighter-rouge">Ctrl</code> + <code class="highlighter-rouge">f</code>， <code class="highlighter-rouge">Ctrl</code> + <code class="highlighter-rouge">b</code> 等？因为 <code class="highlighter-rouge">Ctrl</code> + <code class="highlighter-rouge">*</code> 本身就是浏览器的热键，还需考虑如何屏蔽。</p>

<p>另外，可以用 jQuery 简单实现平滑滚动而非直接定位，或者也可自己写，在此鄙人不想折腾了。</p>

<p>哦，对了，鄙人已将代码部署到本博，顺便学一下知乎，加按 <code class="highlighter-rouge">c</code> 查看评论，赶紧使用 <code class="highlighter-rouge">g</code> <code class="highlighter-rouge">g</code> 试试吧～</p>

<h2 id="id-section-7">参考资料</h2>

<p><strong>本文历史</strong></p>

<ul>
  <li>2015 年 09 月 20 日 完成初稿</li>
</ul>

  </div>

  <div id="posts">
    <div id="random-posts" class="posts">
      <strong>猜你喜欢</strong>
      <ul>
      </ul>
    </div>
  
    <div id="recent-posts" class="posts">
      <strong>最近更新</strong>
      <ul>
      
        <li><a href="/configuring-ip-address-by-specifying-gateway" title="配置特定 IP 地址走指定网关">配置特定 IP 地址走指定网关 </a></li>
      
        <li><a href="/add-google-satellite-layer-in-amap" title="高德地图 API 叠加谷歌地图图层">高德地图 API 叠加谷歌地图图层 </a></li>
      
        <li><a href="/from-codoon-to-nikeplus" title="将咕咚的数据导入到 Nike+">将咕咚的数据导入到 Nike+ </a></li>
      
        <li><a href="/the-influence-of-sports-apps" title="运动 APP 的作用">运动 APP 的作用 </a></li>
      
        <li><a href="/the-last-run-of-june" title="今年 6 月的最后一次跑步">今年 6 月的最后一次跑步 </a></li>
      
      </ul>
    </div>
  </div>

  <div id="info" class="tech">

    <span id="share">
  <div id="qrcode"></div>
  <a id="wechat" title="分享到微信" data-wechat-url="http://127.0.0.1:4000/vim-key-bindings-for-web-page" href="javascript:void(0);"><i class="icon-wechat"></i></a>
  <a id="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=JavaScript 实现 Vim 键绑定 | 殷东亮的博客 via @&amp;url=http://127.0.0.1:4000/vim-key-bindings-for-web-page&amp;type=3&amp;searchPic=1"><i class="icon-weibo"></i></a>
  <a id="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://127.0.0.1:4000/vim-key-bindings-for-web-page&amp;title=JavaScript 实现 Vim 键绑定 | 殷东亮的博客&amp;summary=一旦习惯 Vim 的热键操作，网页浏览也会想用熟悉的热键操作，有人为热门浏览器开发了扩展，例如 Firefox 有个人觉得近完美的扩展解决方案 Vimperator 或 Pentadactyl，Chrome 则有不大完美的 Vichrome、Vimium 等，还有些人直接写了类 vi 的浏览器，例如 dwb，不过我想没用过 vi 的人不会去尝试这样的扩展或软件。&amp;site=http://127.0.0.1:4000"><i class="icon-qzone"></i></a>
  <a id="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1:4000/vim-key-bindings-for-web-page&amp;text=JavaScript 实现 Vim 键绑定｜殷东亮的博客&amp;via="><i class="icon-twitter"></i></a>
  <a id="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://127.0.0.1:4000/vim-key-bindings-for-web-page&amp;t=JavaScript 实现 Vim 键绑定 | 殷东亮的博客"><i class="icon-facebook-official"></i></a>
  <a id="gplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://127.0.0.1:4000/vim-key-bindings-for-web-page"><i class="icon-gplus-squared"></i></a>
</span>


    <span class='like'><a href="javascript:void(0)" title=""><i class="icon-heart-empty"></i> <span class="disqus-like-count"></span></a></span>
    <span class='view-code'><a href="javascript:void(0)" data-md="https://raw.githubusercontent.com/fooleap/fooleap.github.io/master/_posts/2015-09-20-vim-key-bindings-for-web-page.md" title="在正文中查看源码"><i class="icon-file-code"></i>源码</a></span>
    <span class="number-of-word"><i class="icon-calc"></i>5415 字</span>
    <span class="page-tags"><i class="icon-tags"></i><ul class="tags"> <li class="tag"><a href="/tags.html#JavaScript" target="_blank" title="查看“JavaScript”的相关文章">JavaScript</a></li><li class="tag"><a href="/tags.html#Vim" target="_blank" title="查看“Vim”的相关文章">Vim</a></li><li class="tag"><a href="/tags.html#Key Bindings" target="_blank" title="查看“Key Bindings”的相关文章">Key Bindings</a></li><li class="tag"><a href="/tags.html#快捷键" target="_blank" title="查看“快捷键”的相关文章">快捷键</a></li></ul></span>
  </div>

</article>

<div class="comment" id="disqus_thread">
    <a class="show-comments" href="http://127.0.0.1:4000/vim-key-bindings-for-web-page#disqus_thread" data-disqus-identifier="/vim-key-bindings-for-web-page"><span class="has-comment"><i class="icon-chat-empty"></i> 留下</span>评论 <span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:4000/vim-key-bindings-for-web-page"></span></a>
</div>

  
      <footer class="site-footer">
        <small>&copy; 2012-2016 by Jekyll Theme</small>
      </footer>
  
    </main>

  </div>
  <div id="backtotop">
    <i class="icon-up-big"></i>
  </div>
  <script type="text/javascript" src="/assets/js/main.js"></script>
  </body>
</html>
